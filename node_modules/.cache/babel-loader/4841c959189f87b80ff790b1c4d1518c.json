{"ast":null,"code":"import _regeneratorRuntime from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from\"react\";import\"../styles/Prest_.css\";import{useHistory}from'react-router-dom';import{useAuth}from\"../context/userContext\";// context\nimport{ButtonSmall,ButtonLarge}from'../components/utilities/Buttons';import Layout from'../components/utilities/Layout';import Title from'../components/utilities/Title';import SubTitle from'../components/utilities/SubTitle';import ReactLoading from'react-loading';import{useFirebase}from\"../assets/base-context\";import{FaCheckCircle}from'react-icons/fa';import{CSSTransition}from'react-transition-group';var Prest_Step3=function Prest_Step3(){var firebaseContext=useFirebase();var storage=firebaseContext.storage();var initialDocuments={kbis:\"\",ci:\"\",assurance:\"\",sepa:\"\",rib:\"\"};var _useState=useState({type:\"\",message:\"\"}),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),buttonLoading=_useState4[0],setButtonLoading=_useState4[1];var _useState5=useState(initialDocuments),_useState6=_slicedToArray(_useState5,2),documents=_useState6[0],setDocuments=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isMounted=_useState8[0],setIsMounted=_useState8[1];var _useAuth=useAuth(),seller=_useAuth.seller,setCurrentStepProcess=_useAuth.setCurrentStepProcess,addSellerDocuments=_useAuth.addSellerDocuments,getSellerDocumentsFromDB=_useAuth.getSellerDocumentsFromDB;// context\nvar history=useHistory();// seller.status !== \"subscribing\" && history.push('/mon-compte-partenaire')\nsetCurrentStepProcess(3);useEffect(function(){function getCurrentDocumentsFromDB(){getSellerDocumentsFromDB().then(function(data){if(data===null){setDocuments(initialDocuments);}else{setDocuments(data);}});}getCurrentDocumentsFromDB();setIsMounted(true);},[]);function handleInputChange(e,docType){var type=e.target.files[0].type;var size=e.target.files[0].size;if(type!==\"image/png\"&&type!==\"image/jpeg\"&&type!==\"image/jpg\"&&type!==\"application/pdf\"){setError({type:docType,message:\"Votre fichier n'est ni une image jpeg, jpg, png ou PDF.\"});}else if(size>2000000){setError({type:docType,message:\"Votre image fait plus de 2Mo.\"});}else{e.target.files[0].docType=docType;docType===\"kbis\"?setDocuments(_objectSpread(_objectSpread({},documents),{},{kbis:e.target.files[0]})):docType===\"ci\"?setDocuments(_objectSpread(_objectSpread({},documents),{},{ci:e.target.files[0]})):docType===\"assurance\"&&setDocuments(_objectSpread(_objectSpread({},documents),{},{assurance:e.target.files[0]}));setError({type:\"\",message:\"\"});}}function handleSendForm(){return _handleSendForm.apply(this,arguments);}function _handleSendForm(){_handleSendForm=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var documentsUrlArray,doc,token,url,modifiedFiles;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setButtonLoading(true);if(!(documents.kbis.name&&documents.ci.name&&documents.assurance.name)){_context.next=22;break;}documentsUrlArray=_objectSpread({},documents);_context.t0=_regeneratorRuntime.keys(documents);case 4:if((_context.t1=_context.t0()).done){_context.next=14;break;}doc=_context.t1.value;if(!documents[doc].lastModified){_context.next=12;break;}token=\"\".concat(documents[doc].docType,\"-\").concat(Math.random().toString(36).substr(2,19));_context.next=10;return handleUploadFile(documents[doc],token);case 10:url=_context.sent;documentsUrlArray[documents[doc].docType]={url:url,token:token,name:documents[doc].name};case 12:_context.next=4;break;case 14:modifiedFiles=Object.values(documents).filter(function(doc){return doc.lastModified!==undefined;});_context.t2=modifiedFiles.length>0;if(!_context.t2){_context.next=19;break;}_context.next=19;return addSellerDocuments(documentsUrlArray);case 19:history.push('/mon-compte-partenaire/process/verification-2');_context.next=24;break;case 22:setError({type:\"docCount\",message:\"Il manque des documents. Le Kbis, la carte d'identité, et l'assurance de responsabilité civile, sont obligatoires.\"});setButtonLoading(false);case 24:case\"end\":return _context.stop();}}},_callee);}));return _handleSendForm.apply(this,arguments);}function handleUploadFile(image,token){return new Promise(function(resolve,reject){var upload=storage.ref(\"sellers/\".concat(token)).put(image);upload.on(\"state_changed\",function(snapshot){},function(error){console.log(error);},function(){storage.ref(\"sellers\").child(token).getDownloadURL().then(function(url){resolve(url);}).catch(function(error){console.error(error);reject(error);});});});}return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(CSSTransition,{in:isMounted,timeout:300,classNames:\"pageTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsxs(\"div\",{className:\"layoutDocumentPrest\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step3-Header\",children:[/*#__PURE__*/_jsx(SubTitle,{value:\"V\\xE9rification documents\",type:\"big\",font:\"roboto-medium\",align:\"left\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sur cette page vous allez devoir nous transmettre vos documents, pour que nous puissions v\\xE9rifier votre activit\\xE9.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Merci de bien les v\\xE9rifier avant envoi, il ne peut y avoir de modifications possibles.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step3-Section1\",children:[/*#__PURE__*/_jsx(Title,{value:\"KBIS actualis\\xE9 ou relev\\xE9 Siren\",type:\"h2\",font:\"roboto-medium\",align:\"left\"}),error.type===\"kbis\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:error.message}),/*#__PURE__*/_jsx(\"p\",{children:\"Evitez les photos floues ou trop sombres.\"}),/*#__PURE__*/_jsx(\"input\",{id:\"fileKbis\",className:\"input-file\",type:\"file\",onChange:function onChange(e){return handleInputChange(e,\"kbis\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"fileConditions\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"2Mo max\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Type de fichiers accept\\xE9s : jpeg, jpg, png ou PDF\"})]}),documents.kbis.status&&documents.kbis.status===\"validated\"?/*#__PURE__*/_jsxs(\"p\",{className:\"validMessage\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{style:{marginRight:\"5px\"},size:\"25\",color:\"rgb(120, 213, 152)\"}),\"Votre document a \\xE9t\\xE9 accept\\xE9\"]}):/*#__PURE__*/_jsxs(\"div\",{children:[documents.kbis.status&&documents.kbis.status===\"rejected\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:\"Votre document a \\xE9t\\xE9 refus\\xE9.\"}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return document.getElementById('fileKbis').click();},color:\"blue\",value:\"Charger le document\",marginTop:\"15px\"}),documents.kbis&&documents.kbis.status!==\"rejected\"&&/*#__PURE__*/_jsx(\"span\",{className:\"fileNameOnRight\",children:documents.kbis.name})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step3-Section2\",children:[/*#__PURE__*/_jsx(Title,{value:\"Carte d'identit\\xE9 du g\\xE9rant\",type:\"h2\",font:\"roboto-medium\",align:\"left\"}),error.type===\"ci\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:error.message}),/*#__PURE__*/_jsx(\"p\",{children:\"Evitez les photos floues ou trop sombres.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Merci de nous fournir un document avec le recto et le verso de votre carte d'identit\\xE9.\"}),/*#__PURE__*/_jsx(\"input\",{id:\"fileCi\",className:\"input-file\",type:\"file\",onChange:function onChange(e){return handleInputChange(e,\"ci\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"fileConditions\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"2Mo max\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Type de fichiers accept\\xE9s : jpeg, jpg, png ou PDF\"})]}),documents.ci.status&&documents.ci.status===\"validated\"?/*#__PURE__*/_jsxs(\"p\",{className:\"validMessage\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{style:{marginRight:\"5px\"},size:\"25\",color:\"rgb(120, 213, 152)\"}),\"Votre document a \\xE9t\\xE9 accept\\xE9\"]}):/*#__PURE__*/_jsxs(\"div\",{children:[documents.ci.status&&documents.ci.status===\"rejected\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:\"Votre document a \\xE9t\\xE9 refus\\xE9.\"}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return document.getElementById('fileCi').click();},color:\"blue\",value:\"Charger le document\",marginTop:\"15px\"}),documents.ci&&documents.ci.status!==\"rejected\"&&/*#__PURE__*/_jsx(\"span\",{className:\"fileNameOnRight\",children:documents.ci.name})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step3-Section4\",children:[/*#__PURE__*/_jsx(Title,{value:\"Assurance responsabilit\\xE9 civile professionnelle\",type:\"h2\",font:\"roboto-medium\",align:\"left\"}),error.type===\"assurance\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:error.message}),/*#__PURE__*/_jsx(\"p\",{children:\"Evitez les photos floues ou trop sombres.\"}),/*#__PURE__*/_jsx(\"input\",{id:\"fileAssurance\",className:\"input-file\",type:\"file\",onChange:function onChange(e){return handleInputChange(e,\"assurance\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"fileConditions\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"2Mo max\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Type de fichiers accept\\xE9s : jpeg, jpg, png ou PDF\"})]}),documents.assurance.status&&documents.assurance.status===\"validated\"?/*#__PURE__*/_jsxs(\"p\",{className:\"validMessage\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{style:{marginRight:\"5px\"},size:\"25\",color:\"rgb(120, 213, 152)\"}),\"Votre document a \\xE9t\\xE9 accept\\xE9\"]}):/*#__PURE__*/_jsxs(\"div\",{children:[documents.assurance.status&&documents.assurance.status===\"rejected\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:\"Votre document a \\xE9t\\xE9 refus\\xE9.\"}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return document.getElementById('fileAssurance').click();},color:\"blue\",value:\"Charger le document\",marginTop:\"15px\"}),documents.assurance&&documents.assurance.status!==\"rejected\"&&/*#__PURE__*/_jsx(\"span\",{className:\"fileNameOnRight\",children:documents.assurance.name})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"divider\"}),/*#__PURE__*/_jsx(\"div\",{className:\"Prest-Step3-Section3\",children:/*#__PURE__*/_jsx(ButtonLarge,{onClick:function onClick(){return handleSendForm();},color:\"orange\",value:buttonLoading?/*#__PURE__*/_jsx(ReactLoading,{className:\"loadingSpinnerButton\",type:\"spin\",color:\"white\",height:23,width:23}):\"Passer aux documents suivants\",width:\"400px\"})}),error.type===\"docCount\"&&/*#__PURE__*/_jsx(\"p\",{className:\"PrestErrorMessage\",children:error.message})]})})});};export default Prest_Step3;","map":{"version":3,"sources":["/Users/bonnieclyde/Desktop/Nivid/src/pages/Prest_Step3.js"],"names":["React","useState","useEffect","useHistory","useAuth","ButtonSmall","ButtonLarge","Layout","Title","SubTitle","ReactLoading","useFirebase","FaCheckCircle","CSSTransition","Prest_Step3","firebaseContext","storage","initialDocuments","kbis","ci","assurance","sepa","rib","type","message","error","setError","buttonLoading","setButtonLoading","documents","setDocuments","isMounted","setIsMounted","seller","setCurrentStepProcess","addSellerDocuments","getSellerDocumentsFromDB","history","getCurrentDocumentsFromDB","then","data","handleInputChange","e","docType","target","files","size","handleSendForm","name","documentsUrlArray","doc","lastModified","token","Math","random","toString","substr","handleUploadFile","url","modifiedFiles","Object","values","filter","undefined","length","push","image","Promise","resolve","reject","upload","ref","put","on","snapshot","console","log","child","getDownloadURL","catch","status","marginRight","document","getElementById","click"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport \"../styles/Prest_.css\"\r\nimport { useHistory } from 'react-router-dom'\r\nimport { useAuth } from \"../context/userContext\"; // context\r\n\r\nimport { ButtonSmall, ButtonLarge } from '../components/utilities/Buttons'\r\nimport Layout from '../components/utilities/Layout'\r\nimport Title from '../components/utilities/Title'\r\nimport SubTitle from '../components/utilities/SubTitle'\r\nimport ReactLoading from 'react-loading';\r\nimport { useFirebase } from \"../assets/base-context\";\r\nimport { FaCheckCircle } from 'react-icons/fa';\r\nimport { CSSTransition } from 'react-transition-group'\r\n\r\nconst Prest_Step3 = () => {\r\n    \r\n    const firebaseContext = useFirebase()\r\n    const storage = firebaseContext.storage()\r\n\r\n    const initialDocuments = {\r\n        kbis: \"\",\r\n        ci: \"\",\r\n        assurance: \"\",\r\n        sepa: \"\",\r\n        rib: \"\"\r\n    }\r\n\r\n    const [error, setError] = useState({ type: \"\", message: \"\" });\r\n    const [buttonLoading, setButtonLoading] = useState(false)\r\n\r\n    const [documents, setDocuments] = useState(initialDocuments)\r\n\r\n    const [isMounted, setIsMounted] = useState(false);\r\n\r\n\r\n    const { seller, setCurrentStepProcess, addSellerDocuments, getSellerDocumentsFromDB } = useAuth() // context\r\n    const history = useHistory()\r\n    \r\n    // seller.status !== \"subscribing\" && history.push('/mon-compte-partenaire')\r\n\r\n    setCurrentStepProcess(3)\r\n\r\n    useEffect(() => {\r\n        function getCurrentDocumentsFromDB() {\r\n            getSellerDocumentsFromDB().then(data => {\r\n                if (data === null) {\r\n                    setDocuments(initialDocuments)\r\n                }\r\n                else {\r\n                    setDocuments(data)\r\n                }\r\n            })\r\n        }\r\n        getCurrentDocumentsFromDB()\r\n        setIsMounted(true)\r\n    }, [])\r\n\r\n\r\n    function handleInputChange(e, docType) {\r\n        const type = e.target.files[0].type\r\n        const size = e.target.files[0].size\r\n        if (type !== \"image/png\" && type !== \"image/jpeg\" && type !== \"image/jpg\" && type !== \"application/pdf\") {\r\n            setError({ type: docType, message: \"Votre fichier n'est ni une image jpeg, jpg, png ou PDF.\" })\r\n        }\r\n        else if (size > 2000000) {\r\n            setError({ type: docType, message: \"Votre image fait plus de 2Mo.\" })\r\n        }\r\n        else {\r\n            e.target.files[0].docType = docType\r\n            docType === \"kbis\" ? setDocuments({ ...documents, kbis: e.target.files[0] })\r\n                : docType === \"ci\" ? setDocuments({ ...documents, ci: e.target.files[0] })\r\n                    : docType === \"assurance\" && setDocuments({ ...documents, assurance: e.target.files[0] })\r\n            setError({ type: \"\", message: \"\" })\r\n        }\r\n    }\r\n\r\n    async function handleSendForm() {\r\n        setButtonLoading(true)\r\n        if (documents.kbis.name && documents.ci.name && documents.assurance.name) {\r\n            let documentsUrlArray = { ...documents }\r\n\r\n            for (const doc in documents) {\r\n                if (documents[doc].lastModified) {\r\n                    const token = `${documents[doc].docType}-${Math.random().toString(36).substr(2, 19)}`\r\n                    const url = await handleUploadFile(documents[doc], token)\r\n                    documentsUrlArray[documents[doc].docType] = { url: url, token: token, name: documents[doc].name }\r\n                }\r\n            }\r\n            \r\n            const modifiedFiles = Object.values(documents).filter(doc => doc.lastModified !== undefined)\r\n            modifiedFiles.length > 0 && await addSellerDocuments(documentsUrlArray)\r\n            history.push('/mon-compte-partenaire/process/verification-2')\r\n\r\n        } else {\r\n            setError({ type: \"docCount\", message: \"Il manque des documents. Le Kbis, la carte d'identité, et l'assurance de responsabilité civile, sont obligatoires.\" })\r\n            setButtonLoading(false)\r\n        }\r\n\r\n    }\r\n\r\n    function handleUploadFile(image, token) {\r\n\r\n        return new Promise((resolve, reject) => {\r\n\r\n            const upload = storage.ref(`sellers/${token}`).put(image)\r\n            upload.on(\r\n                \"state_changed\", snapshot => { },\r\n                error => {\r\n                    console.log(error)\r\n                }, () => {\r\n                    storage\r\n                        .ref(\"sellers\")\r\n                        .child(token)\r\n                        .getDownloadURL()\r\n                        .then(url => {\r\n                            resolve(url);\r\n                        })\r\n                        .catch(error => {\r\n                            console.error(error)\r\n                            reject(error);\r\n                        })\r\n                }\r\n            )\r\n        })\r\n    }\r\n\r\n    return (\r\n        <Layout>\r\n            <CSSTransition\r\n                in={isMounted}\r\n                timeout={300}\r\n                classNames=\"pageTransition\"\r\n                unmountOnExit\r\n            >\r\n                <div className=\"layoutDocumentPrest\">\r\n                    <div className=\"Prest-Step3-Header\">\r\n                        <SubTitle value=\"Vérification documents\" type=\"big\" font=\"roboto-medium\" align=\"left\" />\r\n                        <p>Sur cette page vous allez devoir nous transmettre vos documents, pour que nous puissions vérifier votre activité.</p>\r\n                        <p>Merci de bien les vérifier avant envoi, il ne peut y avoir de modifications possibles.</p>\r\n                    </div>\r\n\r\n                    <div className=\"Prest-Step3-Section1\">\r\n                        <Title value=\"KBIS actualisé ou relevé Siren\" type=\"h2\" font=\"roboto-medium\" align=\"left\" />\r\n                        {error.type === \"kbis\" && <p className=\"errorMessage\">{error.message}</p>}\r\n                        <p>Evitez les photos floues ou trop sombres.</p>\r\n                        <input id=\"fileKbis\" className=\"input-file\" type=\"file\" onChange={(e) => handleInputChange(e, \"kbis\")} />\r\n                        <div className=\"fileConditions\">\r\n                            <p>2Mo max</p>\r\n                            <p>Type de fichiers acceptés : jpeg, jpg, png ou PDF</p>\r\n                        </div>\r\n                        {\r\n                            (documents.kbis.status && documents.kbis.status === \"validated\") ?\r\n                                <p className=\"validMessage\"><FaCheckCircle style={{ marginRight: \"5px\" }} size=\"25\" color=\"rgb(120, 213, 152)\" />Votre document a été accepté</p>\r\n                                :\r\n                                <div>\r\n                                    {(documents.kbis.status && documents.kbis.status === \"rejected\") &&\r\n                                        <p className=\"errorMessage\">Votre document a été refusé.</p>\r\n                                    }\r\n                                    <ButtonSmall\r\n                                        onClick={() => document.getElementById('fileKbis').click()}\r\n                                        color=\"blue\"\r\n                                        value=\"Charger le document\"\r\n                                        marginTop=\"15px\"\r\n                                    />\r\n                                    {(documents.kbis && documents.kbis.status !== \"rejected\") && <span className=\"fileNameOnRight\">{documents.kbis.name}</span>}\r\n                                </div>\r\n                        }\r\n                    </div>\r\n\r\n                    <div className=\"Prest-Step3-Section2\">\r\n                        <Title value=\"Carte d'identité du gérant\" type=\"h2\" font=\"roboto-medium\" align=\"left\" />\r\n                        {error.type === \"ci\" && <p className=\"errorMessage\">{error.message}</p>}\r\n                        <p>Evitez les photos floues ou trop sombres.</p>\r\n                        <p>Merci de nous fournir un document avec le recto et le verso de votre carte d'identité.</p>\r\n                        <input id=\"fileCi\" className=\"input-file\" type=\"file\" onChange={(e) => handleInputChange(e, \"ci\")} />\r\n                        <div className=\"fileConditions\">\r\n                            <p>2Mo max</p>\r\n                            <p>Type de fichiers acceptés : jpeg, jpg, png ou PDF</p>\r\n                        </div>\r\n                        {\r\n                            (documents.ci.status && documents.ci.status === \"validated\") ?\r\n                                <p className=\"validMessage\"><FaCheckCircle style={{ marginRight: \"5px\" }} size=\"25\" color=\"rgb(120, 213, 152)\" />Votre document a été accepté</p>\r\n                                :\r\n                                <div>\r\n                                    {(documents.ci.status && documents.ci.status === \"rejected\") &&\r\n                                        <p className=\"errorMessage\">Votre document a été refusé.</p>\r\n                                    }\r\n                                    <ButtonSmall\r\n                                        onClick={() => document.getElementById('fileCi').click()}\r\n                                        color=\"blue\"\r\n                                        value=\"Charger le document\"\r\n                                        marginTop=\"15px\"\r\n                                    />\r\n                                    {(documents.ci && documents.ci.status !== \"rejected\") && <span className=\"fileNameOnRight\">{documents.ci.name}</span>}\r\n                                </div>\r\n                        }\r\n                    </div>\r\n\r\n                    <div className=\"Prest-Step3-Section4\">\r\n                        <Title value=\"Assurance responsabilité civile professionnelle\" type=\"h2\" font=\"roboto-medium\" align=\"left\" />\r\n                        {error.type === \"assurance\" && <p className=\"errorMessage\">{error.message}</p>}\r\n                        <p>Evitez les photos floues ou trop sombres.</p>\r\n                        <input id=\"fileAssurance\" className=\"input-file\" type=\"file\" onChange={(e) => handleInputChange(e, \"assurance\")} />\r\n                        <div className=\"fileConditions\">\r\n                            <p>2Mo max</p>\r\n                            <p>Type de fichiers acceptés : jpeg, jpg, png ou PDF</p>\r\n                        </div>\r\n                        {\r\n                            (documents.assurance.status && documents.assurance.status === \"validated\") ?\r\n                                <p className=\"validMessage\"><FaCheckCircle style={{ marginRight: \"5px\" }} size=\"25\" color=\"rgb(120, 213, 152)\" />Votre document a été accepté</p>\r\n                                :\r\n                                <div>\r\n                                    {(documents.assurance.status && documents.assurance.status === \"rejected\") &&\r\n                                        <p className=\"errorMessage\">Votre document a été refusé.</p>\r\n                                    }\r\n                                    <ButtonSmall\r\n                                        onClick={() => document.getElementById('fileAssurance').click()}\r\n                                        color=\"blue\"\r\n                                        value=\"Charger le document\"\r\n                                        marginTop=\"15px\"\r\n                                    />\r\n                                    {(documents.assurance && documents.assurance.status !== \"rejected\") && <span className=\"fileNameOnRight\">{documents.assurance.name}</span>}\r\n                                </div>\r\n                        }\r\n                    </div>\r\n\r\n\r\n                    <div className=\"divider\"></div>\r\n\r\n                    <div className=\"Prest-Step3-Section3\">\r\n                        <ButtonLarge\r\n                            onClick={() => handleSendForm()}\r\n                            color=\"orange\"\r\n                            value={buttonLoading ? <ReactLoading className=\"loadingSpinnerButton\" type=\"spin\" color=\"white\" height={23} width={23} /> : \"Passer aux documents suivants\"}\r\n                            width=\"400px\"\r\n                        />\r\n                    </div>\r\n                    {error.type === \"docCount\" && <p className=\"PrestErrorMessage\">{error.message}</p>}\r\n                </div>\r\n            </CSSTransition>\r\n        </Layout>\r\n    )\r\n}\r\nexport default Prest_Step3;\r\n"]},"metadata":{},"sourceType":"module"}