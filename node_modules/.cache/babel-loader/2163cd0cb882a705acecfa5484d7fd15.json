{"ast":null,"code":"import _regeneratorRuntime from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/bonnieclyde/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from\"react\";import\"../styles/Prest_.css\";import{useHistory}from'react-router-dom';import{useAuth}from\"../context/userContext\";// context\nimport{ButtonSmall,ButtonLarge}from'../components/utilities/Buttons';import Layout from'../components/utilities/Layout';import Title from'../components/utilities/Title';import SubTitle from'../components/utilities/SubTitle';import ReactLoading from'react-loading';import{FaCheckCircle}from'react-icons/fa';import{useFirebase}from\"../assets/base-context\";import{CSSTransition}from'react-transition-group';var Prest_Step4=function Prest_Step4(){var firebaseContext=useFirebase();var auth=firebaseContext.auth();var storage=firebaseContext.storage();var initialDocuments={kbis:\"\",ci:\"\",assurance:\"\",sepa:\"\",rib:\"\"};var _useState=useState({type:\"\",message:\"\"}),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),buttonLoading=_useState4[0],setButtonLoading=_useState4[1];var _useState5=useState(initialDocuments),_useState6=_slicedToArray(_useState5,2),documents=_useState6[0],setDocuments=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isMounted=_useState8[0],setIsMounted=_useState8[1];var _useAuth=useAuth(),seller=_useAuth.seller,setCurrentStepProcess=_useAuth.setCurrentStepProcess,addSellerDocuments=_useAuth.addSellerDocuments,getSellerDocumentsFromDB=_useAuth.getSellerDocumentsFromDB,setSellerStatus=_useAuth.setSellerStatus;// context\nvar history=useHistory();// seller.status !== \"subscribing\" && history.push('/mon-compte-partenaire')\nsetCurrentStepProcess(4);useEffect(function(){function getCurrentDocumentsFromDB(){getSellerDocumentsFromDB().then(function(data){if(data===null){setDocuments(initialDocuments);}else{setDocuments(data);}});}getCurrentDocumentsFromDB();setIsMounted(true);},[]);function handleInputChange(e,docType){var type=e.target.files[0].type;var size=e.target.files[0].size;if(type!==\"image/png\"&&type!==\"image/jpeg\"&&type!==\"image/jpg\"&&type!==\"application/pdf\"){setError({type:docType,message:\"Votre fichier n'est ni une image jpeg, jpg, png ou PDF.\"});}else if(size>2000000){setError({type:docType,message:\"Votre image fait plus de 2Mo.\"});}else{e.target.files[0].docType=docType;docType===\"sepa\"?setDocuments(_objectSpread(_objectSpread({},documents),{},{sepa:e.target.files[0]})):docType===\"rib\"&&setDocuments(_objectSpread(_objectSpread({},documents),{},{rib:e.target.files[0]}));setError({type:\"\",message:\"\"});}}function handleSendForm(){return _handleSendForm.apply(this,arguments);}function _handleSendForm(){_handleSendForm=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var documentsUrlArray,doc,token,url;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setButtonLoading(true);if(!documents.rib.name){_context.next=19;break;}documentsUrlArray=_objectSpread({},documents);_context.t0=_regeneratorRuntime.keys(documents);case 4:if((_context.t1=_context.t0()).done){_context.next=14;break;}doc=_context.t1.value;if(!documents[doc].lastModified){_context.next=12;break;}token=\"\".concat(documents[doc].docType,\"-\").concat(Math.random().toString(36).substr(2,19));_context.next=10;return handleUploadFile(documents[doc],token);case 10:url=_context.sent;documentsUrlArray[documents[doc].docType]={url:url,token:token,name:documents[doc].name};case 12:_context.next=4;break;case 14:_context.next=16;return addSellerDocuments(documentsUrlArray);case 16:handleSendAll();_context.next=21;break;case 19:setError({type:\"final\",message:\"Pour finaliser votre inscription, le Rib est obligatoire.\"});setButtonLoading(false);case 21:case\"end\":return _context.stop();}}},_callee);}));return _handleSendForm.apply(this,arguments);}function handleSendAll(){return _handleSendAll.apply(this,arguments);}function _handleSendAll(){_handleSendAll=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(seller.description&&seller.description.length>0)){_context2.next=30;break;}if(!(seller.image_path&&seller.image_path.url&&seller.image_path.url.length>0)){_context2.next=27;break;}if(!(seller.services.length>0)){_context2.next=24;break;}if(!(documents.kbis.name&&documents.kbis.status!==\"rejected\")){_context2.next=21;break;}if(!(documents.ci.name&&documents.ci.status!==\"rejected\")){_context2.next=18;break;}if(!(documents.assurance.name&&documents.assurance.status!==\"rejected\")){_context2.next=15;break;}if(!(documents.rib.name&&documents.rib.status!==\"rejected\")){_context2.next=12;break;}_context2.next=9;return setSellerStatus(auth.currentUser.uid,\"pending\");case 9:history.push('/mon-compte-partenaire/confirmation');_context2.next=13;break;case 12:setError({type:\"final\",message:\"Pour finaliser votre inscription, le RIB est obligatoire.\"});case 13:_context2.next=16;break;case 15:setError({type:\"final\",message:\"Pour finaliser votre inscription, l'assurance de responsabilité civile est obligatoire.\"});case 16:_context2.next=19;break;case 18:setError({type:\"final\",message:\"Pour finaliser votre inscription, la carte d'identité du gérant est obligatoire.\"});case 19:_context2.next=22;break;case 21:setError({type:\"final\",message:\"Pour finaliser votre inscription, le Kbis est obligatoire.\"});case 22:_context2.next=25;break;case 24:setError({type:\"final\",message:\"Pour finaliser votre inscription, vous devez avoir ajouté au moins 1 service.\"});case 25:_context2.next=28;break;case 27:setError({type:\"final\",message:\"Pour finaliser votre inscription, merci d'ajouter une photo principale pour votre boutique.\"});case 28:_context2.next=31;break;case 30:setError({type:\"final\",message:\"Pour finaliser votre inscription, vous devez renseigner une description de votre boutique, à l'étape Prestations\"});case 31:setButtonLoading(false);case 32:case\"end\":return _context2.stop();}}},_callee2);}));return _handleSendAll.apply(this,arguments);}function handleUploadFile(image,token){return new Promise(function(resolve,reject){var upload=storage.ref(\"sellers/\".concat(token)).put(image);upload.on(\"state_changed\",function(snapshot){},function(error){console.log(error);},function(){storage.ref(\"sellers\").child(token).getDownloadURL().then(function(url){resolve(url);}).catch(function(error){console.error(error);reject(error);});});});}function handleDownloadSEPA(){var element=document.createElement(\"a\");var file=new Blob([document.getElementById('inputDownload').value],{type:'text/plain;charset=utf-8'});element.href=URL.createObjectURL(file);element.download=\"SEPA.txt\";document.body.appendChild(element);element.click();}return/*#__PURE__*/_jsx(Layout,{children:/*#__PURE__*/_jsx(CSSTransition,{in:isMounted,timeout:300,classNames:\"pageTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsxs(\"div\",{className:\"layoutDocumentPrest\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step4-Header\",children:[/*#__PURE__*/_jsx(SubTitle,{value:\"V\\xE9rification documents\",type:\"big\",font:\"roboto-medium\",align:\"left\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Sur cette page vous allez devoir nous transmettre vos documents, pour que nous puissions v\\xE9rifier votre activit\\xE9.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Merci de bien les v\\xE9rifier avant envoi, il ne peut y avoir de modifications possibles.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step4-Section1\",children:[/*#__PURE__*/_jsx(Title,{value:\"Pr\\xE9l\\xE8vement SEPA \\xE0 remplir\",type:\"h2\",font:\"roboto-medium\",align:\"left\"}),error.type===\"sepa\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:error.message}),/*#__PURE__*/_jsx(\"p\",{children:\"Vous pourrez transf\\xE9rer ce document plus tard sur votre espace ou d\\xE9s maintenant.\"}),/*#__PURE__*/_jsx(\"input\",{id:\"fileSepa\",className:\"input-file\",type:\"file\",onChange:function onChange(e){return handleInputChange(e,\"sepa\");}}),documents.sepa.status&&documents.sepa.status===\"validated\"?/*#__PURE__*/_jsxs(\"p\",{className:\"validMessage\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{style:{marginRight:\"5px\"},size:\"25\",color:\"rgb(120, 213, 152)\"}),\"Votre document a \\xE9t\\xE9 accept\\xE9\"]}):/*#__PURE__*/_jsxs(\"div\",{children:[documents.sepa.status&&documents.sepa.status===\"rejected\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:\"Votre document a \\xE9t\\xE9 refus\\xE9.\"}),/*#__PURE__*/_jsx(\"div\",{id:\"inputDownload\",children:/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleDownloadSEPA();},color:\"orange\",value:\"T\\xE9l\\xE9charger le document\",marginTop:\"20px\"})}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return document.getElementById('fileSepa').click();},color:\"blue\",value:\"Charger le document\",marginTop:\"20px\"}),documents.sepa&&documents.sepa.status!==\"rejected\"&&/*#__PURE__*/_jsx(\"span\",{className:\"fileNameOnRight\",children:documents.sepa.name})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step4-Section2\",children:[/*#__PURE__*/_jsx(Title,{value:\"RIB bancaire\",type:\"h2\",font:\"roboto-medium\",align:\"left\"}),error.type===\"rib\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:error.message}),/*#__PURE__*/_jsx(\"p\",{children:\"Evitez les photos flous ou trop sombres.\"}),/*#__PURE__*/_jsx(\"input\",{id:\"fileRib\",className:\"input-file\",type:\"file\",onChange:function onChange(e){return handleInputChange(e,\"rib\");}}),/*#__PURE__*/_jsxs(\"div\",{className:\"fileConditions\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"2Mo max\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Type de fichiers accept\\xE9s : jpeg, jpg, png ou PDF\"})]}),documents.rib.status&&documents.rib.status===\"validated\"?/*#__PURE__*/_jsxs(\"p\",{className:\"validMessage\",children:[/*#__PURE__*/_jsx(FaCheckCircle,{style:{marginRight:\"5px\"},size:\"25\",color:\"rgb(120, 213, 152)\"}),\"Votre document a \\xE9t\\xE9 accept\\xE9\"]}):/*#__PURE__*/_jsxs(\"div\",{children:[documents.rib.status&&documents.rib.status===\"rejected\"&&/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:\"Votre document a \\xE9t\\xE9 refus\\xE9.\"}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return document.getElementById('fileRib').click();},color:\"blue\",value:\"Charger le document\",marginTop:\"15px\"}),documents.rib&&documents.rib.status!==\"rejected\"&&/*#__PURE__*/_jsx(\"span\",{className:\"fileNameOnRight\",children:documents.rib.name})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"divider\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"Prest-Step4-Section3\",children:[/*#__PURE__*/_jsx(Title,{value:\"Si vous avez termin\\xE9 & bien v\\xE9rifi\\xE9 que vos documents sont correctements enregistr\\xE9s, vous pouvez finaliser votre dossier d'inscription\",type:\"h2\",font:\"roboto-medium\",align:\"left\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"En cochant cette case vous acceptez les \",/*#__PURE__*/_jsx(\"span\",{children:\"conditions g\\xE9n\\xE9rales de ventes\"})]}),/*#__PURE__*/_jsx(ButtonLarge,{onClick:function onClick(){return handleSendForm();},color:\"orange\",value:buttonLoading?/*#__PURE__*/_jsx(ReactLoading,{className:\"loadingSpinnerButton\",type:\"spin\",color:\"white\",height:23,width:23}):\"Finaliser mon inscription\",width:\"400px\"})]}),error.type===\"final\"&&/*#__PURE__*/_jsx(\"p\",{className:\"PrestErrorMessage\",children:error.message})]})})});};export default Prest_Step4;","map":{"version":3,"sources":["/Users/bonnieclyde/Desktop/Nivid/src/pages/Prest_Step4.js"],"names":["React","useState","useEffect","useHistory","useAuth","ButtonSmall","ButtonLarge","Layout","Title","SubTitle","ReactLoading","FaCheckCircle","useFirebase","CSSTransition","Prest_Step4","firebaseContext","auth","storage","initialDocuments","kbis","ci","assurance","sepa","rib","type","message","error","setError","buttonLoading","setButtonLoading","documents","setDocuments","isMounted","setIsMounted","seller","setCurrentStepProcess","addSellerDocuments","getSellerDocumentsFromDB","setSellerStatus","history","getCurrentDocumentsFromDB","then","data","handleInputChange","e","docType","target","files","size","handleSendForm","name","documentsUrlArray","doc","lastModified","token","Math","random","toString","substr","handleUploadFile","url","handleSendAll","description","length","image_path","services","status","currentUser","uid","push","image","Promise","resolve","reject","upload","ref","put","on","snapshot","console","log","child","getDownloadURL","catch","handleDownloadSEPA","element","document","createElement","file","Blob","getElementById","value","href","URL","createObjectURL","download","body","appendChild","click","marginRight"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport \"../styles/Prest_.css\"\r\nimport { useHistory } from 'react-router-dom'\r\nimport { useAuth } from \"../context/userContext\"; // context\r\n\r\nimport { ButtonSmall, ButtonLarge } from '../components/utilities/Buttons'\r\nimport Layout from '../components/utilities/Layout'\r\nimport Title from '../components/utilities/Title'\r\nimport SubTitle from '../components/utilities/SubTitle'\r\nimport ReactLoading from 'react-loading';\r\nimport { FaCheckCircle } from 'react-icons/fa';\r\nimport { useFirebase } from \"../assets/base-context\";\r\n\r\nimport { CSSTransition } from 'react-transition-group'\r\n\r\nconst Prest_Step4 = () => {\r\n    \r\n    const firebaseContext = useFirebase()\r\n    const auth = firebaseContext.auth()\r\n    const storage = firebaseContext.storage()\r\n\r\n    const initialDocuments = {\r\n        kbis: \"\",\r\n        ci: \"\",\r\n        assurance: \"\",\r\n        sepa: \"\",\r\n        rib: \"\"\r\n    }\r\n\r\n    const [error, setError] = useState({ type: \"\", message: \"\" });\r\n    const [buttonLoading, setButtonLoading] = useState(false)\r\n\r\n    const [documents, setDocuments] = useState(initialDocuments)\r\n\r\n    const [isMounted, setIsMounted] = useState(false);\r\n\r\n    const { seller, setCurrentStepProcess, addSellerDocuments, getSellerDocumentsFromDB, setSellerStatus } = useAuth() // context\r\n    const history = useHistory()\r\n\r\n    // seller.status !== \"subscribing\" && history.push('/mon-compte-partenaire')\r\n\r\n    setCurrentStepProcess(4)\r\n\r\n    useEffect(() => {\r\n        function getCurrentDocumentsFromDB() {\r\n            getSellerDocumentsFromDB().then(data => {\r\n                if (data === null) {\r\n                    setDocuments(initialDocuments)\r\n                }\r\n                else {\r\n                    setDocuments(data)\r\n                }\r\n            })\r\n        }\r\n        getCurrentDocumentsFromDB()\r\n        setIsMounted(true)\r\n    }, [])\r\n\r\n    function handleInputChange(e, docType) {\r\n        const type = e.target.files[0].type\r\n        const size = e.target.files[0].size\r\n        if (type !== \"image/png\" && type !== \"image/jpeg\" && type !== \"image/jpg\" && type !== \"application/pdf\") {\r\n            setError({ type: docType, message: \"Votre fichier n'est ni une image jpeg, jpg, png ou PDF.\" })\r\n        }\r\n        else if (size > 2000000) {\r\n            setError({ type: docType, message: \"Votre image fait plus de 2Mo.\" })\r\n        }\r\n        else {\r\n            e.target.files[0].docType = docType\r\n            docType === \"sepa\" ? setDocuments({ ...documents, sepa: e.target.files[0] })\r\n                : docType === \"rib\" && setDocuments({ ...documents, rib: e.target.files[0] })\r\n            setError({ type: \"\", message: \"\" })\r\n        }\r\n    }\r\n\r\n    async function handleSendForm() {\r\n        setButtonLoading(true)\r\n        if (documents.rib.name) {\r\n            let documentsUrlArray = { ...documents }\r\n\r\n            for (const doc in documents) {\r\n                if (documents[doc].lastModified) {\r\n                    const token = `${documents[doc].docType}-${Math.random().toString(36).substr(2, 19)}`\r\n                    const url = await handleUploadFile(documents[doc], token)\r\n                    documentsUrlArray[documents[doc].docType] = { url: url, token: token, name: documents[doc].name }\r\n                }\r\n            }\r\n            await addSellerDocuments(documentsUrlArray)\r\n            handleSendAll()\r\n        }\r\n        else {\r\n            setError({ type: \"final\", message: \"Pour finaliser votre inscription, le Rib est obligatoire.\" })\r\n            setButtonLoading(false)\r\n        }\r\n    }\r\n\r\n    async function handleSendAll() {\r\n\r\n        if (seller.description && seller.description.length > 0) {\r\n            if (seller.image_path && seller.image_path.url && seller.image_path.url.length > 0) {\r\n                if (seller.services.length > 0) {\r\n                    if (documents.kbis.name && documents.kbis.status !== \"rejected\") {\r\n                        if (documents.ci.name && documents.ci.status !== \"rejected\") {\r\n                            if (documents.assurance.name && documents.assurance.status !== \"rejected\") {\r\n                                if (documents.rib.name && documents.rib.status !== \"rejected\") {\r\n                                    await setSellerStatus(auth.currentUser.uid, \"pending\")\r\n                                    history.push('/mon-compte-partenaire/confirmation')\r\n                                } else {\r\n                                    setError({ type: \"final\", message: \"Pour finaliser votre inscription, le RIB est obligatoire.\" })\r\n                                }\r\n                            } else {\r\n                                setError({ type: \"final\", message: \"Pour finaliser votre inscription, l'assurance de responsabilité civile est obligatoire.\" })\r\n                            }\r\n                        } else {\r\n                            setError({ type: \"final\", message: \"Pour finaliser votre inscription, la carte d'identité du gérant est obligatoire.\" })\r\n                        }\r\n                    } else {\r\n                        setError({ type: \"final\", message: \"Pour finaliser votre inscription, le Kbis est obligatoire.\" })\r\n                    }\r\n                } else {\r\n                    setError({ type: \"final\", message: \"Pour finaliser votre inscription, vous devez avoir ajouté au moins 1 service.\" })\r\n                }\r\n            } else {\r\n                setError({ type: \"final\", message: \"Pour finaliser votre inscription, merci d'ajouter une photo principale pour votre boutique.\" })\r\n            }\r\n        }\r\n        else {\r\n            setError({ type: \"final\", message: \"Pour finaliser votre inscription, vous devez renseigner une description de votre boutique, à l'étape Prestations\" })\r\n        }\r\n        setButtonLoading(false)\r\n    }\r\n\r\n    function handleUploadFile(image, token) {\r\n\r\n        return new Promise((resolve, reject) => {\r\n\r\n            const upload = storage.ref(`sellers/${token}`).put(image)\r\n            upload.on(\r\n                \"state_changed\", snapshot => { },\r\n                error => {\r\n                    console.log(error)\r\n                }, () => {\r\n                    storage\r\n                        .ref(\"sellers\")\r\n                        .child(token)\r\n                        .getDownloadURL()\r\n                        .then(url => {\r\n                            resolve(url);\r\n                        })\r\n                        .catch(error => {\r\n                            console.error(error)\r\n                            reject(error);\r\n                        })\r\n                }\r\n            )\r\n        })\r\n    }\r\n\r\n    function handleDownloadSEPA() {\r\n\r\n        const element = document.createElement(\"a\");\r\n        const file = new Blob([document.getElementById('inputDownload').value],\r\n            { type: 'text/plain;charset=utf-8' });\r\n        element.href = URL.createObjectURL(file);\r\n        element.download = \"SEPA.txt\";\r\n        document.body.appendChild(element);\r\n        element.click();\r\n    }\r\n\r\n    return (\r\n        <Layout>\r\n            <CSSTransition\r\n                in={isMounted}\r\n                timeout={300}\r\n                classNames=\"pageTransition\"\r\n                unmountOnExit\r\n            >\r\n                <div className=\"layoutDocumentPrest\">\r\n                    <div className=\"Prest-Step4-Header\">\r\n                        <SubTitle value=\"Vérification documents\" type=\"big\" font=\"roboto-medium\" align=\"left\" />\r\n                        <p>Sur cette page vous allez devoir nous transmettre vos documents, pour que nous puissions vérifier votre activité.</p>\r\n                        <p>Merci de bien les vérifier avant envoi, il ne peut y avoir de modifications possibles.</p>\r\n                    </div>\r\n\r\n                    <div className=\"Prest-Step4-Section1\">\r\n                        <Title value=\"Prélèvement SEPA à remplir\" type=\"h2\" font=\"roboto-medium\" align=\"left\" />\r\n                        {error.type === \"sepa\" && <p className=\"errorMessage\">{error.message}</p>}\r\n                        <p>Vous pourrez transférer ce document plus tard sur votre espace ou dés maintenant.</p>\r\n                        <input id=\"fileSepa\" className=\"input-file\" type=\"file\" onChange={(e) => handleInputChange(e, \"sepa\")} />\r\n\r\n                        {\r\n                            (documents.sepa.status && documents.sepa.status === \"validated\") ?\r\n                                <p className=\"validMessage\"><FaCheckCircle style={{ marginRight: \"5px\" }} size=\"25\" color=\"rgb(120, 213, 152)\" />Votre document a été accepté</p>\r\n                                :\r\n                                <div>\r\n                                    {(documents.sepa.status && documents.sepa.status === \"rejected\") &&\r\n                                        <p className=\"errorMessage\">Votre document a été refusé.</p>\r\n                                    }\r\n                                    <div id=\"inputDownload\">\r\n                                        <ButtonSmall\r\n                                            onClick={() => handleDownloadSEPA()}\r\n                                            color=\"orange\"\r\n                                            value=\"Télécharger le document\"\r\n                                            marginTop=\"20px\"\r\n                                        />\r\n                                    </div>\r\n                                    <ButtonSmall\r\n                                        onClick={() => document.getElementById('fileSepa').click()}\r\n                                        color=\"blue\"\r\n                                        value=\"Charger le document\"\r\n                                        marginTop=\"20px\"\r\n                                    />\r\n                                    {(documents.sepa && documents.sepa.status !== \"rejected\") && <span className=\"fileNameOnRight\">{documents.sepa.name}</span>}\r\n                                </div>\r\n\r\n                        }\r\n                    </div>\r\n\r\n                    <div className=\"Prest-Step4-Section2\">\r\n                        <Title value=\"RIB bancaire\" type=\"h2\" font=\"roboto-medium\" align=\"left\" />\r\n                        {error.type === \"rib\" && <p className=\"errorMessage\">{error.message}</p>}\r\n                        <p>Evitez les photos flous ou trop sombres.</p>\r\n                        <input id=\"fileRib\" className=\"input-file\" type=\"file\" onChange={(e) => handleInputChange(e, \"rib\")} />\r\n                        <div className=\"fileConditions\">\r\n                            <p>2Mo max</p>\r\n                            <p>Type de fichiers acceptés : jpeg, jpg, png ou PDF</p>\r\n                        </div>\r\n                        {\r\n                            (documents.rib.status && documents.rib.status === \"validated\") ?\r\n                                <p className=\"validMessage\"><FaCheckCircle style={{ marginRight: \"5px\" }} size=\"25\" color=\"rgb(120, 213, 152)\" />Votre document a été accepté</p>\r\n                                :\r\n                                <div>\r\n                                    {(documents.rib.status && documents.rib.status === \"rejected\") &&\r\n                                        <p className=\"errorMessage\">Votre document a été refusé.</p>\r\n                                    }\r\n                                    <ButtonSmall\r\n                                        onClick={() => document.getElementById('fileRib').click()}\r\n                                        color=\"blue\"\r\n                                        value=\"Charger le document\"\r\n                                        marginTop=\"15px\"\r\n                                    />\r\n                                    {(documents.rib && documents.rib.status !== \"rejected\") && <span className=\"fileNameOnRight\">{documents.rib.name}</span>}\r\n                                </div>\r\n                        }\r\n\r\n                    </div>\r\n\r\n\r\n                    <div className=\"divider\"></div>\r\n\r\n                    <div className=\"Prest-Step4-Section3\">\r\n                        <Title value=\"Si vous avez terminé & bien vérifié que vos documents sont correctements enregistrés, vous pouvez finaliser votre dossier d'inscription\" type=\"h2\" font=\"roboto-medium\" align=\"left\" />\r\n                        <p>En cochant cette case vous acceptez les <span>conditions générales de ventes</span></p>\r\n                        <ButtonLarge\r\n                            onClick={() => handleSendForm()}\r\n                            color=\"orange\"\r\n                            value={buttonLoading ? <ReactLoading className=\"loadingSpinnerButton\" type=\"spin\" color=\"white\" height={23} width={23} /> : \"Finaliser mon inscription\"}\r\n                            width=\"400px\"\r\n                        />\r\n                    </div>\r\n                    {error.type === \"final\" && <p className=\"PrestErrorMessage\">{error.message}</p>}\r\n                </div>\r\n            </CSSTransition>\r\n        </Layout>\r\n    )\r\n}\r\nexport default Prest_Step4;\r\n"]},"metadata":{},"sourceType":"module"}