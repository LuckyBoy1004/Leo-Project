{"ast":null,"code":"import _regeneratorRuntime from\"F:/My Project/Leo/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/My Project/Leo/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"F:/My Project/Leo/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"F:/My Project/Leo/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect}from\"react\";import{useAuth}from'../context/userContext';import AdapterDateFns from'@mui/lab/AdapterDateFns';import LocalizationProvider from'@mui/lab/LocalizationProvider';import DatePicker from'@mui/lab/DatePicker';import frLocale from'date-fns/locale/fr';import MobileDatePicker from'@mui/lab/MobileDatePicker';import ReactLoading from'react-loading';import{ButtonSmall}from'./utilities/Buttons';var UpdateProfil=function UpdateProfil(props){var isMobile=props.isMobile;var _useAuth=useAuth(),user=_useAuth.user,getCurrentUserProfil=_useAuth.getCurrentUserProfil,updateCurrentUserProfil=_useAuth.updateCurrentUserProfil,verifyLogin=_useAuth.verifyLogin,updateUserEmail=_useAuth.updateUserEmail;var _useState=useState({gender:\"f\"}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState({field:\"\",message:\"\"}),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isCalendarOpened=_useState8[0],setIsCalendarOpened=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),confirm=_useState10[0],setConfirm=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),newEmail=_useState12[0],setNewEmail=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),confirmEmail=_useState14[0],setConfirmEmail=_useState14[1];var _useState15=useState(\"\"),_useState16=_slicedToArray(_useState15,2),password=_useState16[0],setPassword=_useState16[1];useEffect(function(){getCurrentUserProfil().then(function(results){setData(_objectSpread(_objectSpread(_objectSpread({},data),results),{},{birthDate:results.birthDate&&new Date(results.birthDate.seconds*1000)}));setNewEmail(results.email);setLoading(false);});},[]);// function isInputDisabled(input) {\n//     if (data[input] !== undefined && data[input].length >= 2) {\n//         return true\n//     }\n//     else {\n//         return false\n//     }\n// }\nfunction verifyFields(){return _verifyFields.apply(this,arguments);}function _verifyFields(){_verifyFields=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(data.firstName!==undefined&&data.firstName.length>=2)){_context3.next=21;break;}if(!(data.name!==undefined&&data.name.length>=2)){_context3.next=18;break;}if(!(data.gender!==undefined&&data.gender.length>0)){_context3.next=15;break;}if(!(data.birthDate!==undefined)){_context3.next=12;break;}if(!(data.tel===undefined||data.tel.length===10||data.tel.length===0)){_context3.next=9;break;}setError({field:\"\",message:\"\"});return _context3.abrupt(\"return\",true);case 9:return _context3.abrupt(\"return\",setError({field:\"tel\",message:\"Merci de renseigner un numéro de téléphone valide.\"}));case 10:_context3.next=13;break;case 12:return _context3.abrupt(\"return\",setError({field:\"birthDate\",message:\"Merci de renseigner votre date de naissance.\"}));case 13:_context3.next=16;break;case 15:return _context3.abrupt(\"return\",setError({field:\"gender\",message:\"Merci de renseigner votre sexe.\"}));case 16:_context3.next=19;break;case 18:return _context3.abrupt(\"return\",setError({field:\"name\",message:\"Merci de renseigner votre nom.\"}));case 19:_context3.next=22;break;case 21:return _context3.abrupt(\"return\",setError({field:\"firstName\",message:\"Merci de renseigner votre prénom.\"}));case 22:case\"end\":return _context3.stop();}}},_callee3);}));return _verifyFields.apply(this,arguments);}function handleSaveUpdate(){verifyFields().then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(res){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(res===true)){_context2.next=12;break;}if(!(user.providerData[0].providerId===\"google.com\")){_context2.next=7;break;}_context2.next=4;return updateCurrentUserProfil(data);case 4:setConfirm(true);_context2.next=12;break;case 7:if(!(newEmail===confirmEmail)){_context2.next=11;break;}verifyLogin(data.email,password).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return updateCurrentUserProfil(_objectSpread(_objectSpread({},data),{},{email:newEmail}));case 2:_context.next=4;return updateUserEmail(newEmail);case 4:return _context.abrupt(\"return\",setConfirm(true));case 5:case\"end\":return _context.stop();}}},_callee);}));return function(_x2){return _ref2.apply(this,arguments);};}()).catch(function(error){if(error.code===\"auth/wrong-password\"){return setError({field:\"password\",message:\"Le mot de passe est incorrect.\"});}});_context2.next=12;break;case 11:return _context2.abrupt(\"return\",setError({field:\"emailConfirm\",message:\"Les deux adresses e-mail doivent être identiques.\"}));case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref.apply(this,arguments);};}());}return loading?/*#__PURE__*/_jsx(\"div\",{className:isMobile?\"dashboardUpdate mobile\":\"dashboardUpdate\",children:/*#__PURE__*/_jsx(ReactLoading,{className:isMobile?\"loadingSpinner mobile\":\"loadingSpinner\",type:\"spin\",color:\"rgba(245, 192, 67)\",height:50,width:50})}):/*#__PURE__*/_jsx(\"div\",{className:isMobile?\"dashboardUpdate mobile\":\"dashboardUpdate\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"leftSide\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Vos informations personnelles\"}),/*#__PURE__*/_jsx(\"div\",{className:\"updateProfilInfoBox\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Pour modifier d'autres informations vous concernant, \",/*#__PURE__*/_jsx(\"span\",{children:\"contactez-nous\"}),\".\"]})}),/*#__PURE__*/_jsx(\"p\",{className:\"errorMessage\",children:error.message}),/*#__PURE__*/_jsxs(\"div\",{className:\"updateProfilContent\",children:[/*#__PURE__*/_jsxs(\"div\",{className:error.field===\"firstName\"?\"formField error\":\"formField\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Pr\\xE9nom*\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"firstName\",value:data.firstName,onChange:function onChange(e){return setData(_objectSpread(_objectSpread({},data),{},{firstName:e.target.value}));}})]}),/*#__PURE__*/_jsxs(\"div\",{className:error.field===\"name\"?\"formField error\":\"formField\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nom*\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"name\",value:data.name,onChange:function onChange(e){return setData(_objectSpread(_objectSpread({},data),{},{name:e.target.value}));}})]}),/*#__PURE__*/_jsxs(\"div\",{className:error.field===\"gender\"?\"formField error\":\"formField\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Sexe*\"}),/*#__PURE__*/_jsxs(\"select\",{value:data.gender,onChange:function onChange(e){return setData(_objectSpread(_objectSpread({},data),{},{gender:e.target.value}));},children:[/*#__PURE__*/_jsx(\"option\",{selected:data.gender===\"h\"&&\"selected\",value:\"h\",children:\"Homme\"}),/*#__PURE__*/_jsx(\"option\",{selected:data.gender===\"f\"&&\"selected\",value:\"f\",children:\"Femme\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:error.field===\"birthDate\"?\"formFieldSpecialDate error\":\"formFieldSpecialDate\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Date de naissance*\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setIsCalendarOpened(!isCalendarOpened);},className:\"etape1DatePicker subscribe\",children:data.birthDate!==undefined?new Date(data.birthDate).toLocaleDateString(\"fr-FR\",{year:\"numeric\",month:\"long\",day:\"numeric\"}):\"Date de naissance\"}),isCalendarOpened&&/*#__PURE__*/_jsx(\"div\",{className:\"calendarContainerAbsolute\",children:/*#__PURE__*/_jsx(LocalizationProvider,{style:{position:\"relative!important\"},locale:frLocale,dateAdapter:AdapterDateFns,children:isMobile?/*#__PURE__*/_jsx(MobileDatePicker,{label:\"Date de l'\\xE9v\\xE8nement\",open:isCalendarOpened,onClose:function onClose(){return setIsCalendarOpened(false);},value:data.birthDate,onChange:function onChange(val){return setData(_objectSpread(_objectSpread({},data),{},{birthDate:val})),setIsCalendarOpened(false);},renderInput:function renderInput(){return null;}}):/*#__PURE__*/_jsx(DatePicker,{open:isCalendarOpened,onClose:function onClose(){return setIsCalendarOpened(false);},value:data.birthDate,onChange:function onChange(val){return setData(_objectSpread(_objectSpread({},data),{},{birthDate:val})),setIsCalendarOpened(false);},renderInput:function renderInput(){return null;}})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:error.field===\"tel\"?\"formField error\":\"formField\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Num\\xE9ro de t\\xE9l\\xE9phone\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"tel\",value:data.tel,onChange:function onChange(e){return setData(_objectSpread(_objectSpread({},data),{},{tel:e.target.value}));}})]}),user.providerData[0].providerId!==\"google.com\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"formField\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Adresse e-mail\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"email\",value:newEmail,onChange:function onChange(e){return setNewEmail(e.target.value);}})]}),user.providerData[0].providerId!==\"google.com\"&&/*#__PURE__*/_jsxs(\"div\",{className:error.field===\"emailConfirm\"?\"formField error\":\"formField\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Confirmation e-mail\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"email\",onChange:function onChange(e){return setConfirmEmail(e.target.value);}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"updateProfilConfirm\",children:[user.providerData[0].providerId!==\"google.com\"?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Pour confirmer les changements, merci de renseigner votre mot de passe actuel dans le champ ci-dessous :\"}),/*#__PURE__*/_jsx(\"div\",{className:error.field===\"password\"?\"formField error\":\"formField\",children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",onChange:function onChange(e){return setPassword(e.target.value);}})}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleSaveUpdate();},color:\"orange\",value:\"Enregistrer les modifications\",disabled:password.length<2})]}):/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleSaveUpdate();},color:\"orange\",value:\"Enregistrer les modifications\"}),/*#__PURE__*/_jsx(\"div\",{children:confirm&&/*#__PURE__*/_jsx(\"p\",{className:\"green\",children:\"Vos informations personnelles ont bien \\xE9t\\xE9 mis \\xE0 jour.\"})})]})]})});};export default UpdateProfil;","map":{"version":3,"sources":["F:/My Project/Leo/Nivid/src/components/UpdateProfil.js"],"names":["React","useState","useEffect","useAuth","AdapterDateFns","LocalizationProvider","DatePicker","frLocale","MobileDatePicker","ReactLoading","ButtonSmall","UpdateProfil","props","isMobile","user","getCurrentUserProfil","updateCurrentUserProfil","verifyLogin","updateUserEmail","gender","data","setData","loading","setLoading","field","message","error","setError","isCalendarOpened","setIsCalendarOpened","confirm","setConfirm","newEmail","setNewEmail","confirmEmail","setConfirmEmail","password","setPassword","then","results","birthDate","Date","seconds","email","verifyFields","firstName","undefined","length","name","tel","handleSaveUpdate","res","providerData","providerId","catch","code","e","target","value","toLocaleDateString","year","month","day","position","val"],"mappings":"4oBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,OAAT,KAAwB,wBAAxB,CAEA,MAAOC,CAAAA,cAAP,KAA2B,yBAA3B,CACA,MAAOC,CAAAA,oBAAP,KAAiC,+BAAjC,CACA,MAAOC,CAAAA,UAAP,KAAuB,qBAAvB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oBAArB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,2BAA7B,CAEA,MAAOC,CAAAA,YAAP,KAAyB,eAAzB,CAEA,OAASC,WAAT,KAA4B,qBAA5B,CAEA,GAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,KAAD,CAAW,CAE5B,GAAMC,CAAAA,QAAQ,CAAGD,KAAK,CAACC,QAAvB,CAF4B,aAIkEV,OAAO,EAJzE,CAIpBW,IAJoB,UAIpBA,IAJoB,CAIdC,oBAJc,UAIdA,oBAJc,CAIQC,uBAJR,UAIQA,uBAJR,CAIiCC,WAJjC,UAIiCA,WAJjC,CAI8CC,eAJ9C,UAI8CA,eAJ9C,eAMJjB,QAAQ,CAAC,CAC7BkB,MAAM,CAAE,GADqB,CAAD,CANJ,wCAMrBC,IANqB,eAMfC,OANe,8BASEpB,QAAQ,CAAC,IAAD,CATV,yCASrBqB,OATqB,eASZC,UATY,8BAUFtB,QAAQ,CAAC,CAC/BuB,KAAK,CAAE,EADwB,CAE/BC,OAAO,CAAE,EAFsB,CAAD,CAVN,yCAUrBC,KAVqB,eAUdC,QAVc,8BAcoB1B,QAAQ,CAAC,KAAD,CAd5B,yCAcrB2B,gBAdqB,eAcHC,mBAdG,8BAeE5B,QAAQ,CAAC,KAAD,CAfV,0CAerB6B,OAfqB,gBAeZC,UAfY,gCAiBI9B,QAAQ,CAAC,EAAD,CAjBZ,2CAiBrB+B,QAjBqB,gBAiBXC,WAjBW,gCAkBYhC,QAAQ,CAAC,EAAD,CAlBpB,2CAkBrBiC,YAlBqB,gBAkBPC,eAlBO,gCAmBIlC,QAAQ,CAAC,EAAD,CAnBZ,2CAmBrBmC,QAnBqB,gBAmBXC,WAnBW,gBAsB5BnC,SAAS,CAAC,UAAM,CACZa,oBAAoB,GAAGuB,IAAvB,CAA4B,SAAAC,OAAO,CAAI,CACnClB,OAAO,8CAAMD,IAAN,EAAemB,OAAf,MAAwBC,SAAS,CAAED,OAAO,CAACC,SAAR,EAAqB,GAAIC,CAAAA,IAAJ,CAASF,OAAO,CAACC,SAAR,CAAkBE,OAAlB,CAA4B,IAArC,CAAxD,GAAP,CACAT,WAAW,CAACM,OAAO,CAACI,KAAT,CAAX,CACApB,UAAU,CAAC,KAAD,CAAV,CACH,CAJD,EAKH,CANQ,CAMN,EANM,CAAT,CAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArC4B,QAuCbqB,CAAAA,YAvCa,8IAuC5B,6IACQxB,IAAI,CAACyB,SAAL,GAAmBC,SAAnB,EAAgC1B,IAAI,CAACyB,SAAL,CAAeE,MAAf,EAAyB,CADjE,iCAEY3B,IAAI,CAAC4B,IAAL,GAAcF,SAAd,EAA2B1B,IAAI,CAAC4B,IAAL,CAAUD,MAAV,EAAoB,CAF3D,iCAGgB3B,IAAI,CAACD,MAAL,GAAgB2B,SAAhB,EAA6B1B,IAAI,CAACD,MAAL,CAAY4B,MAAZ,CAAqB,CAHlE,iCAIoB3B,IAAI,CAACoB,SAAL,GAAmBM,SAJvC,iCAKwB1B,IAAI,CAAC6B,GAAL,GAAaH,SAAb,EAA0B1B,IAAI,CAAC6B,GAAL,CAASF,MAAT,GAAoB,EAA9C,EAAoD3B,IAAI,CAAC6B,GAAL,CAASF,MAAT,GAAoB,CALhG,2BAMwBpB,QAAQ,CAAC,CAAEH,KAAK,CAAE,EAAT,CAAaC,OAAO,CAAE,EAAtB,CAAD,CAAR,CANxB,iCAO+B,IAP/B,0CAU+BE,QAAQ,CAAC,CAAEH,KAAK,CAAE,KAAT,CAAgBC,OAAO,CAAE,oDAAzB,CAAD,CAVvC,2EAc2BE,QAAQ,CAAC,CAAEH,KAAK,CAAE,WAAT,CAAsBC,OAAO,CAAE,8CAA/B,CAAD,CAdnC,2EAkBuBE,QAAQ,CAAC,CAAEH,KAAK,CAAE,QAAT,CAAmBC,OAAO,CAAE,iCAA5B,CAAD,CAlB/B,2EAsBmBE,QAAQ,CAAC,CAAEH,KAAK,CAAE,MAAT,CAAiBC,OAAO,CAAE,gCAA1B,CAAD,CAtB3B,2EA0BeE,QAAQ,CAAC,CAAEH,KAAK,CAAE,WAAT,CAAsBC,OAAO,CAAE,mCAA/B,CAAD,CA1BvB,2DAvC4B,+CAqE5B,QAASyB,CAAAA,gBAAT,EAA4B,CACxBN,YAAY,GACPN,IADL,0FACU,kBAAMa,GAAN,2HACEA,GAAG,GAAK,IADV,iCAEMrC,IAAI,CAACsC,YAAL,CAAkB,CAAlB,EAAqBC,UAArB,GAAoC,YAF1C,kDAGYrC,CAAAA,uBAAuB,CAACI,IAAD,CAHnC,QAIMW,UAAU,CAAC,IAAD,CAAV,CAJN,oCAOUC,QAAQ,GAAKE,YAPvB,4BAQUjB,WAAW,CAACG,IAAI,CAACuB,KAAN,CAAaP,QAAb,CAAX,CAAkCE,IAAlC,2FAAuC,iBAAMa,GAAN,wIAC7BnC,CAAAA,uBAAuB,gCAAMI,IAAN,MAAYuB,KAAK,CAAEX,QAAnB,GADM,8BAE7Bd,CAAAA,eAAe,CAACc,QAAD,CAFc,wCAG5BD,UAAU,CAAC,IAAD,CAHkB,wDAAvC,kEAKKuB,KALL,CAKW,SAAA5B,KAAK,CAAI,CACZ,GAAIA,KAAK,CAAC6B,IAAN,GAAe,qBAAnB,CAA0C,CACtC,MAAO5B,CAAAA,QAAQ,CAAC,CAAEH,KAAK,CAAE,UAAT,CAAqBC,OAAO,CAAE,gCAA9B,CAAD,CAAf,CACH,CACJ,CATL,EARV,iEAoBiBE,QAAQ,CAAC,CAAEH,KAAK,CAAE,cAAT,CAAyBC,OAAO,CAAE,mDAAlC,CAAD,CApBzB,2DADV,gEA0BH,CAED,MAAOH,CAAAA,OAAO,cACV,YAAK,SAAS,CAAET,QAAQ,CAAG,wBAAH,CAA8B,iBAAtD,uBACI,KAAC,YAAD,EAAc,SAAS,CAAEA,QAAQ,CAAG,uBAAH,CAA6B,gBAA9D,CAAgF,IAAI,CAAC,MAArF,CAA4F,KAAK,CAAC,oBAAlG,CAAuH,MAAM,CAAE,EAA/H,CAAmI,KAAK,CAAE,EAA1I,EADJ,EADU,cAKN,YAAK,SAAS,CAAEA,QAAQ,CAAG,wBAAH,CAA8B,iBAAtD,uBACI,aAAK,SAAS,CAAC,UAAf,wBACI,qDADJ,cAEI,YAAK,SAAS,CAAC,qBAAf,uBACI,0FAAwD,wCAAxD,OADJ,EAFJ,cAKI,UAAG,SAAS,CAAC,cAAb,UAA6Ba,KAAK,CAACD,OAAnC,EALJ,cAMI,aAAK,SAAS,CAAC,qBAAf,wBAEI,aAAK,SAAS,CAAEC,KAAK,CAACF,KAAN,GAAgB,WAAhB,CAA8B,iBAA9B,CAAkD,WAAlE,wBACI,qCADJ,cAEI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,WAAxB,CAAoC,KAAK,CAAEJ,IAAI,CAACyB,SAAhD,CAA2D,QAAQ,CAAE,kBAACW,CAAD,QAAOnC,CAAAA,OAAO,gCAAMD,IAAN,MAAYyB,SAAS,CAAEW,CAAC,CAACC,MAAF,CAASC,KAAhC,GAAd,EAArE,EAFJ,GAFJ,cAOI,aAAK,SAAS,CAAEhC,KAAK,CAACF,KAAN,GAAgB,MAAhB,CAAyB,iBAAzB,CAA6C,WAA7D,wBACI,+BADJ,cAEI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,MAAxB,CAA+B,KAAK,CAAEJ,IAAI,CAAC4B,IAA3C,CAAiD,QAAQ,CAAE,kBAACQ,CAAD,QAAOnC,CAAAA,OAAO,gCAAMD,IAAN,MAAY4B,IAAI,CAAEQ,CAAC,CAACC,MAAF,CAASC,KAA3B,GAAd,EAA3D,EAFJ,GAPJ,cAYI,aAAK,SAAS,CAAEhC,KAAK,CAACF,KAAN,GAAgB,QAAhB,CAA2B,iBAA3B,CAA+C,WAA/D,wBACI,gCADJ,cAEI,gBAAQ,KAAK,CAAEJ,IAAI,CAACD,MAApB,CAA4B,QAAQ,CAAE,kBAACqC,CAAD,QAAOnC,CAAAA,OAAO,gCAAMD,IAAN,MAAYD,MAAM,CAAEqC,CAAC,CAACC,MAAF,CAASC,KAA7B,GAAd,EAAtC,wBACI,eAAQ,QAAQ,CAAEtC,IAAI,CAACD,MAAL,GAAgB,GAAhB,EAAuB,UAAzC,CAAqD,KAAK,CAAC,GAA3D,mBADJ,cAEI,eAAQ,QAAQ,CAAEC,IAAI,CAACD,MAAL,GAAgB,GAAhB,EAAuB,UAAzC,CAAqD,KAAK,CAAC,GAA3D,mBAFJ,GAFJ,GAZJ,cAoBI,aAAK,SAAS,CAAEO,KAAK,CAACF,KAAN,GAAgB,WAAhB,CAA8B,4BAA9B,CAA6D,sBAA7E,wBACI,6CADJ,cAEI,YACI,OAAO,CAAE,yBAAMK,CAAAA,mBAAmB,CAAC,CAACD,gBAAF,CAAzB,EADb,CAEI,SAAS,CAAC,4BAFd,UAKQR,IAAI,CAACoB,SAAL,GAAmBM,SAAnB,CACI,GAAIL,CAAAA,IAAJ,CAASrB,IAAI,CAACoB,SAAd,EAAyBmB,kBAAzB,CAA4C,OAA5C,CAAqD,CAAEC,IAAI,CAAE,SAAR,CAAmBC,KAAK,CAAE,MAA1B,CAAkCC,GAAG,CAAE,SAAvC,CAArD,CADJ,CAGI,mBARZ,EAFJ,CAaKlC,gBAAgB,eACb,YAAK,SAAS,CAAC,2BAAf,uBACI,KAAC,oBAAD,EAAsB,KAAK,CAAE,CAAEmC,QAAQ,CAAE,oBAAZ,CAA7B,CAAiE,MAAM,CAAExD,QAAzE,CAAmF,WAAW,CAAEH,cAAhG,UACKS,QAAQ,cACL,KAAC,gBAAD,EACI,KAAK,CAAC,2BADV,CAEI,IAAI,CAAEe,gBAFV,CAGI,OAAO,CAAE,yBAAMC,CAAAA,mBAAmB,CAAC,KAAD,CAAzB,EAHb,CAII,KAAK,CAAET,IAAI,CAACoB,SAJhB,CAKI,QAAQ,CAAE,kBAACwB,GAAD,QAAU3C,CAAAA,OAAO,gCAAMD,IAAN,MAAYoB,SAAS,CAAEwB,GAAvB,GAAP,CAAsCnC,mBAAmB,CAAC,KAAD,CAAnE,EALd,CAMI,WAAW,CAAE,6BAAM,KAAN,EANjB,EADK,cAUL,KAAC,UAAD,EACI,IAAI,CAAED,gBADV,CAEI,OAAO,CAAE,yBAAMC,CAAAA,mBAAmB,CAAC,KAAD,CAAzB,EAFb,CAGI,KAAK,CAAET,IAAI,CAACoB,SAHhB,CAII,QAAQ,CAAE,kBAACwB,GAAD,QAAU3C,CAAAA,OAAO,gCAAMD,IAAN,MAAYoB,SAAS,CAAEwB,GAAvB,GAAP,CAAsCnC,mBAAmB,CAAC,KAAD,CAAnE,EAJd,CAKI,WAAW,CAAE,6BAAM,KAAN,EALjB,EAXR,EADJ,EAdR,GApBJ,cA2DI,aAAK,SAAS,CAAEH,KAAK,CAACF,KAAN,GAAgB,KAAhB,CAAwB,iBAAxB,CAA4C,WAA5D,wBACI,uDADJ,cAEI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,KAAxB,CAA8B,KAAK,CAAEJ,IAAI,CAAC6B,GAA1C,CAA+C,QAAQ,CAAE,kBAACO,CAAD,QAAOnC,CAAAA,OAAO,gCAAMD,IAAN,MAAY6B,GAAG,CAAEO,CAAC,CAACC,MAAF,CAASC,KAA1B,GAAd,EAAzD,EAFJ,GA3DJ,CAgEK5C,IAAI,CAACsC,YAAL,CAAkB,CAAlB,EAAqBC,UAArB,GAAoC,YAApC,eACG,aAAK,SAAS,CAAC,WAAf,wBACI,yCADJ,cAEI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,OAAxB,CAAgC,KAAK,CAAErB,QAAvC,CAAiD,QAAQ,CAAE,kBAACwB,CAAD,QAAOvB,CAAAA,WAAW,CAACuB,CAAC,CAACC,MAAF,CAASC,KAAV,CAAlB,EAA3D,EAFJ,GAjER,CAuEQ5C,IAAI,CAACsC,YAAL,CAAkB,CAAlB,EAAqBC,UAArB,GAAoC,YAApC,eACA,aAAK,SAAS,CAAE3B,KAAK,CAACF,KAAN,GAAgB,cAAhB,CAAiC,iBAAjC,CAAqD,WAArE,wBACI,8CADJ,cAEI,cAAO,IAAI,CAAC,MAAZ,CAAmB,IAAI,CAAC,OAAxB,CAAgC,QAAQ,CAAE,kBAACgC,CAAD,QAAOrB,CAAAA,eAAe,CAACqB,CAAC,CAACC,MAAF,CAASC,KAAV,CAAtB,EAA1C,EAFJ,GAxER,GANJ,cAqFI,aAAK,SAAS,CAAC,qBAAf,WAGQ5C,IAAI,CAACsC,YAAL,CAAkB,CAAlB,EAAqBC,UAArB,GAAoC,YAApC,cACI,oCACI,+HADJ,cAEI,YAAK,SAAS,CAAE3B,KAAK,CAACF,KAAN,GAAgB,UAAhB,CAA6B,iBAA7B,CAAiD,WAAjE,uBACI,cAAO,IAAI,CAAC,UAAZ,CAAuB,IAAI,CAAC,UAA5B,CAAuC,QAAQ,CAAE,kBAACgC,CAAD,QAAOnB,CAAAA,WAAW,CAACmB,CAAC,CAACC,MAAF,CAASC,KAAV,CAAlB,EAAjD,EADJ,EAFJ,cAKI,KAAC,WAAD,EACI,OAAO,CAAE,yBAAMR,CAAAA,gBAAgB,EAAtB,EADb,CAEI,KAAK,CAAC,QAFV,CAGI,KAAK,CAAC,+BAHV,CAII,QAAQ,CAAEd,QAAQ,CAACW,MAAT,CAAkB,CAJhC,EALJ,GADJ,cAcI,KAAC,WAAD,EACI,OAAO,CAAE,yBAAMG,CAAAA,gBAAgB,EAAtB,EADb,CAEI,KAAK,CAAC,QAFV,CAGI,KAAK,CAAC,+BAHV,EAjBZ,cAwBI,qBACKpB,OAAO,eACJ,UAAG,SAAS,CAAC,OAAb,6EAFR,EAxBJ,GArFJ,GADJ,EALR,CA4HH,CA9ND,CAgOA,cAAenB,CAAAA,YAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useAuth } from '../context/userContext'\r\n\r\nimport AdapterDateFns from '@mui/lab/AdapterDateFns';\r\nimport LocalizationProvider from '@mui/lab/LocalizationProvider';\r\nimport DatePicker from '@mui/lab/DatePicker';\r\nimport frLocale from 'date-fns/locale/fr';\r\nimport MobileDatePicker from '@mui/lab/MobileDatePicker';\r\n\r\nimport ReactLoading from 'react-loading';\r\n\r\nimport { ButtonSmall } from './utilities/Buttons'\r\n\r\nconst UpdateProfil = (props) => {\r\n\r\n    const isMobile = props.isMobile\r\n\r\n    const { user, getCurrentUserProfil, updateCurrentUserProfil, verifyLogin, updateUserEmail } = useAuth()\r\n\r\n    const [data, setData] = useState({\r\n        gender: \"f\"\r\n    })\r\n    const [loading, setLoading] = useState(true)\r\n    const [error, setError] = useState({\r\n        field: \"\",\r\n        message: \"\"\r\n    })\r\n    const [isCalendarOpened, setIsCalendarOpened] = useState(false)\r\n    const [confirm, setConfirm] = useState(false)\r\n\r\n    const [newEmail, setNewEmail] = useState(\"\")\r\n    const [confirmEmail, setConfirmEmail] = useState(\"\")\r\n    const [password, setPassword] = useState(\"\")\r\n\r\n\r\n    useEffect(() => {\r\n        getCurrentUserProfil().then(results => {\r\n            setData({ ...data, ...results, birthDate: results.birthDate && new Date(results.birthDate.seconds * 1000) })\r\n            setNewEmail(results.email)\r\n            setLoading(false)\r\n        })\r\n    }, [])\r\n\r\n    // function isInputDisabled(input) {\r\n    //     if (data[input] !== undefined && data[input].length >= 2) {\r\n    //         return true\r\n    //     }\r\n    //     else {\r\n    //         return false\r\n    //     }\r\n    // }\r\n\r\n    async function verifyFields() {\r\n        if (data.firstName !== undefined && data.firstName.length >= 2) {\r\n            if (data.name !== undefined && data.name.length >= 2) {\r\n                if (data.gender !== undefined && data.gender.length > 0) {\r\n                    if (data.birthDate !== undefined) {\r\n                        if (data.tel === undefined || data.tel.length === 10 || data.tel.length === 0) {\r\n                            setError({ field: \"\", message: \"\" })\r\n                            return true\r\n                        }\r\n                        else {\r\n                            return setError({ field: \"tel\", message: \"Merci de renseigner un numéro de téléphone valide.\" })\r\n                        }\r\n                    }\r\n                    else {\r\n                        return setError({ field: \"birthDate\", message: \"Merci de renseigner votre date de naissance.\" })\r\n                    }\r\n                }\r\n                else {\r\n                    return setError({ field: \"gender\", message: \"Merci de renseigner votre sexe.\" })\r\n                }\r\n            }\r\n            else {\r\n                return setError({ field: \"name\", message: \"Merci de renseigner votre nom.\" })\r\n            }\r\n        }\r\n        else {\r\n            return setError({ field: \"firstName\", message: \"Merci de renseigner votre prénom.\" })\r\n        }\r\n    }\r\n\r\n    function handleSaveUpdate() {\r\n        verifyFields()\r\n            .then(async res => {\r\n                if (res === true) {\r\n                    if (user.providerData[0].providerId === \"google.com\") {\r\n                        await updateCurrentUserProfil(data)\r\n                        setConfirm(true)\r\n                    }\r\n                    else {\r\n                        if (newEmail === confirmEmail) {\r\n                            verifyLogin(data.email, password).then(async res => {\r\n                                await updateCurrentUserProfil({ ...data, email: newEmail })\r\n                                await updateUserEmail(newEmail)\r\n                                return setConfirm(true)\r\n                            })\r\n                                .catch(error => {\r\n                                    if (error.code === \"auth/wrong-password\") {\r\n                                        return setError({ field: \"password\", message: \"Le mot de passe est incorrect.\" })\r\n                                    }\r\n                                })\r\n                        }\r\n                        else {\r\n                            return setError({ field: \"emailConfirm\", message: \"Les deux adresses e-mail doivent être identiques.\" })\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n    }\r\n\r\n    return loading ?\r\n        <div className={isMobile ? \"dashboardUpdate mobile\" : \"dashboardUpdate\"}>\r\n            <ReactLoading className={isMobile ? \"loadingSpinner mobile\" : \"loadingSpinner\"} type=\"spin\" color=\"rgba(245, 192, 67)\" height={50} width={50} />\r\n        </div>\r\n        : (\r\n            <div className={isMobile ? \"dashboardUpdate mobile\" : \"dashboardUpdate\"}>\r\n                <div className=\"leftSide\">\r\n                    <h1>Vos informations personnelles</h1>\r\n                    <div className=\"updateProfilInfoBox\">\r\n                        <p>Pour modifier d'autres informations vous concernant, <span>contactez-nous</span>.</p>\r\n                    </div>\r\n                    <p className=\"errorMessage\">{error.message}</p>\r\n                    <div className=\"updateProfilContent\">\r\n\r\n                        <div className={error.field === \"firstName\" ? \"formField error\" : \"formField\"}>\r\n                            <label>Prénom*</label>\r\n                            <input type=\"text\" name=\"firstName\" value={data.firstName} onChange={(e) => setData({ ...data, firstName: e.target.value })} />\r\n                        </div>\r\n\r\n                        <div className={error.field === \"name\" ? \"formField error\" : \"formField\"}>\r\n                            <label>Nom*</label>\r\n                            <input type=\"text\" name=\"name\" value={data.name} onChange={(e) => setData({ ...data, name: e.target.value })} />\r\n                        </div>\r\n\r\n                        <div className={error.field === \"gender\" ? \"formField error\" : \"formField\"}>\r\n                            <label>Sexe*</label>\r\n                            <select value={data.gender} onChange={(e) => setData({ ...data, gender: e.target.value })}>\r\n                                <option selected={data.gender === \"h\" && \"selected\"} value=\"h\">Homme</option>\r\n                                <option selected={data.gender === \"f\" && \"selected\"} value=\"f\">Femme</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div className={error.field === \"birthDate\" ? \"formFieldSpecialDate error\" : \"formFieldSpecialDate\"}>\r\n                            <label>Date de naissance*</label>\r\n                            <div\r\n                                onClick={() => setIsCalendarOpened(!isCalendarOpened)}\r\n                                className=\"etape1DatePicker subscribe\"\r\n                            >\r\n                                {\r\n                                    data.birthDate !== undefined ?\r\n                                        new Date(data.birthDate).toLocaleDateString(\"fr-FR\", { year: \"numeric\", month: \"long\", day: \"numeric\" })\r\n                                        :\r\n                                        \"Date de naissance\"\r\n                                }\r\n                            </div>\r\n                            {isCalendarOpened &&\r\n                                <div className=\"calendarContainerAbsolute\">\r\n                                    <LocalizationProvider style={{ position: \"relative!important\" }} locale={frLocale} dateAdapter={AdapterDateFns}>\r\n                                        {isMobile ?\r\n                                            <MobileDatePicker\r\n                                                label=\"Date de l'évènement\"\r\n                                                open={isCalendarOpened}\r\n                                                onClose={() => setIsCalendarOpened(false)}\r\n                                                value={data.birthDate}\r\n                                                onChange={(val) => (setData({ ...data, birthDate: val }), setIsCalendarOpened(false))}\r\n                                                renderInput={() => null}\r\n                                            />\r\n                                            :\r\n                                            <DatePicker\r\n                                                open={isCalendarOpened}\r\n                                                onClose={() => setIsCalendarOpened(false)}\r\n                                                value={data.birthDate}\r\n                                                onChange={(val) => (setData({ ...data, birthDate: val }), setIsCalendarOpened(false))}\r\n                                                renderInput={() => null}\r\n                                            />\r\n                                        }\r\n                                    </LocalizationProvider>\r\n                                </div>\r\n                            }\r\n                        </div>\r\n\r\n                        <div className={error.field === \"tel\" ? \"formField error\" : \"formField\"}>\r\n                            <label>Numéro de téléphone</label>\r\n                            <input type=\"text\" name=\"tel\" value={data.tel} onChange={(e) => setData({ ...data, tel: e.target.value })} />\r\n                        </div>\r\n\r\n                        {user.providerData[0].providerId !== \"google.com\" &&\r\n                            <div className=\"formField\">\r\n                                <label>Adresse e-mail</label>\r\n                                <input type=\"text\" name=\"email\" value={newEmail} onChange={(e) => setNewEmail(e.target.value)} />\r\n                            </div>\r\n                        }\r\n                        {\r\n                            user.providerData[0].providerId !== \"google.com\" &&\r\n                            <div className={error.field === \"emailConfirm\" ? \"formField error\" : \"formField\"}>\r\n                                <label>Confirmation e-mail</label>\r\n                                <input type=\"text\" name=\"email\" onChange={(e) => setConfirmEmail(e.target.value)} />\r\n                            </div>\r\n                        }\r\n                    </div>\r\n\r\n                    <div className=\"updateProfilConfirm\">\r\n\r\n                        {\r\n                            user.providerData[0].providerId !== \"google.com\" ?\r\n                                <div>\r\n                                    <p>Pour confirmer les changements, merci de renseigner votre mot de passe actuel dans le champ ci-dessous :</p>\r\n                                    <div className={error.field === \"password\" ? \"formField error\" : \"formField\"}>\r\n                                        <input type=\"password\" name=\"password\" onChange={(e) => setPassword(e.target.value)} />\r\n                                    </div>\r\n                                    <ButtonSmall\r\n                                        onClick={() => handleSaveUpdate()}\r\n                                        color=\"orange\"\r\n                                        value=\"Enregistrer les modifications\"\r\n                                        disabled={password.length < 2}\r\n                                    />\r\n                                </div>\r\n                                :\r\n                                <ButtonSmall\r\n                                    onClick={() => handleSaveUpdate()}\r\n                                    color=\"orange\"\r\n                                    value=\"Enregistrer les modifications\"\r\n                                />\r\n\r\n                        }\r\n                        <div>\r\n                            {confirm &&\r\n                                <p className=\"green\">Vos informations personnelles ont bien été mis à jour.</p>\r\n                            }\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        )\r\n}\r\n\r\nexport default UpdateProfil"]},"metadata":{},"sourceType":"module"}