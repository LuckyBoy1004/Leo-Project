{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Home\\\\Desktop\\\\Boulot\\\\Nivid\\\\src\\\\pages\\\\Prest_Step1.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport \"../styles/Prest_.css\";\nimport { useHistory } from \"react-router-dom\";\nimport { useAuth } from \"../context/userContext\"; // context\n\nimport { ButtonSmall, ButtonLarge } from \"../components/utilities/Buttons\";\nimport Layout from \"../components/utilities/Layout\";\nimport Title from \"../components/utilities/Title\";\nimport SubTitle from \"../components/utilities/SubTitle\";\nimport { items } from \"../components/servicesData\";\nimport { useFirebase } from \"../assets/base-context\";\nimport ReactLoading from \"react-loading\";\nimport { CSSTransition } from \"react-transition-group\";\nimport { useLocation } from \"react-router-dom\";\n\nconst Prest_Step1 = () => {\n  _s();\n\n  const firebaseContext = useFirebase();\n  const storage = firebaseContext.storage();\n  const [error, setError] = useState({\n    type: \"\",\n    message: \"\"\n  });\n  const [buttonLoading, setButtonLoading] = useState(false);\n  const [isMounted, setIsMounted] = useState(false);\n  const search = useLocation().search;\n  const session_id = new URLSearchParams(search).get(\"session_id\");\n  const initialSellerDetails = {\n    description: \"\",\n    category: \"\",\n    subcategory: \"\",\n    image_path: \"\"\n  };\n  const initialPictures = {\n    name: \"\",\n    url: \"\",\n    lastModified: 0,\n    size: 0,\n    type: \"\",\n    webkitRelativePath: \"\"\n  };\n  const [sellerDetails, setSellerDetails] = useState(initialSellerDetails);\n  const [pictures, setPictures] = useState(initialPictures);\n  const {\n    setCurrentStepProcess,\n    setImageSellerDB,\n    addSellerDescription,\n    seller,\n    deleteOldSellerPicture,\n    checkoutCheck,\n    refSellers,\n    setSeller\n  } = useAuth(); // context\n\n  const history = useHistory();\n  seller.status !== \"subscribing\" && history.push(\"/mon-compte-partenaire\");\n  setCurrentStepProcess(1);\n  useEffect(() => {\n    setSellerDetails({\n      description: seller.description,\n      category: seller.category,\n      subcategory: seller.subcategory,\n      image_path: seller.image_path\n    });\n    return setIsMounted(true);\n  }, []);\n  useEffect(() => {\n    if (session_id) {\n      checkoutCheck(session_id).then(res => {\n        if (res.status === \"paid\") {\n          refSellers.doc(seller.uid).update({\n            subscription_id: res.id\n          });\n          setSeller({ ...seller,\n            subscription_id: res.id\n          });\n        } else history.push(\"/mon-compte-partenaire/process/abonnement\");\n      });\n    }\n  }, []);\n  useEffect(() => {\n    console.log(session_id);\n    if (!seller.subscription_id && session_id === null) history.push(\"/mon-compte-partenaire/process/abonnement\");\n  }, []);\n\n  function handleCategoryChange(category, subcategory) {\n    if (category !== sellerDetails.category) {\n      setSellerDetails({ ...sellerDetails,\n        category: category,\n        subcategory: subcategory\n      });\n    }\n  }\n\n  function handleSubCategoryChange(key) {\n    if (key !== sellerDetails.subcategory) {\n      setSellerDetails({ ...sellerDetails,\n        subcategory: key\n      });\n    }\n  }\n\n  function handleChange(e) {\n    const type = e.target.files[0].type;\n    const size = e.target.files[0].size;\n\n    if (type !== \"image/png\" && type !== \"image/jpeg\" && type !== \"image/jpg\") {\n      setError({\n        type: \"imageType\",\n        message: \"Votre fichier n'est ni une image jpeg, jpg ou PNG.\"\n      });\n    } else if (size > 2000000) {\n      setError({\n        type: \"imageSize\",\n        message: \"Votre image fait plus de 2Mo.\"\n      });\n    } else {\n      setPictures(e.target.files[0]);\n      setSellerDetails({ ...sellerDetails,\n        image_path: {\n          url: URL.createObjectURL(e.target.files[0])\n        }\n      });\n      setError({\n        type: \"\",\n        message: \"\"\n      });\n    }\n  }\n\n  async function isFormValid() {\n    if (sellerDetails.description.length > 350) {\n      if (sellerDetails.category.length > 1 && sellerDetails.subcategory.length > 1) {\n        if (pictures.name && pictures.name.length > 0 || (sellerDetails.image_path && sellerDetails.image_path.url.length) > 0) {\n          return true;\n        } else {\n          setButtonLoading(false);\n          setError({\n            type: \"noImage\",\n            message: \"Vous devez ajouter une image.\"\n          });\n        }\n      } else {\n        setButtonLoading(false);\n        setError({\n          type: \"noCategory\",\n          message: \"Vous devez séléctionner votre secteur d'activité.\"\n        });\n      }\n    } else {\n      setButtonLoading(false);\n      setError({\n        type: \"description\",\n        message: \"Votre description doit faire au moins 350 caractères.\"\n      });\n    }\n  }\n\n  async function handleSendForm() {\n    setButtonLoading(true);\n    setError({\n      type: \"\",\n      message: \"\"\n    });\n    const valid = await isFormValid();\n\n    if (valid === true) {\n      let tokenAndUrl = {\n        url: \"\",\n        token: \"\"\n      }; // Si la photo est une nouvelle\n\n      if (pictures.name.length > 0) {\n        const token = Math.random().toString(36).substr(2, 19);\n        const url = await handleUploadFile(token);\n        await setImageSellerDB(url, token);\n        tokenAndUrl = {\n          url: url,\n          token: token\n        };\n        seller.image_path.url && deleteOldSellerPicture([seller.image_path.token]);\n      } else {\n        tokenAndUrl = sellerDetails.image_path; // Photo non changée\n      }\n\n      addSellerDescription(sellerDetails, tokenAndUrl).then(() => {\n        setPictures(initialPictures);\n        setSellerDetails({ ...sellerDetails,\n          image_path: tokenAndUrl\n        });\n        setButtonLoading(false);\n        history.push(\"/mon-compte-partenaire/process/services\");\n      });\n    } else {\n      return;\n    }\n  }\n\n  async function handleUploadFile(token) {\n    return new Promise((resolve, reject) => {\n      const upload = storage.ref(`sellers/${token}`).put(pictures);\n      upload.on(\"state_changed\", snapshot => {}, error => {\n        console.log(error);\n      }, () => {\n        storage.ref(\"sellers\").child(token).getDownloadURL().then(url => {\n          resolve(url);\n        }).catch(error => {\n          console.error(error);\n          reject(error);\n        });\n      });\n    });\n  }\n\n  console.log(sellerDetails);\n  return /*#__PURE__*/_jsxDEV(Layout, {\n    children: /*#__PURE__*/_jsxDEV(CSSTransition, {\n      in: isMounted,\n      timeout: 300,\n      classNames: \"pageTransition\",\n      unmountOnExit: true,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(SubTitle, {\n          value: \"Dites-nous en plus sur votre activit\\xE9\",\n          type: \"big\",\n          font: \"roboto-medium\",\n          align: \"left\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Prest-Step1-Section1\",\n          children: [/*#__PURE__*/_jsxDEV(Title, {\n            value: \"Description de votre prestation\",\n            type: \"h2\",\n            font: \"roboto-medium\",\n            align: \"left\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"D\\xE9crivez en d\\xE9tail votre entreprise : aussi bien les services que les produits propos\\xE9s afin de renseigner au mieux vos futurs clients. Notre \\xE9quipe de journalistes r\\xE9visera votre texte afin d'optimiser votre vitrine et vous permettre d'attirer le plus grand nombre de clients. Merci de ne pas inclure de page web, courrier \\xE9lectronique, num\\xE9ro de t\\xE9l\\xE9phone et autres coordonn\\xE9es de contact.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"textAreaContainer\",\n            children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n              value: sellerDetails.description,\n              onChange: e => setSellerDetails({ ...sellerDetails,\n                description: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: sellerDetails.description.length > 349 && \"valid\",\n              children: [sellerDetails.description.length, \"/350\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 263,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 253,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Prest-Step1-Section2\",\n          children: [/*#__PURE__*/_jsxDEV(Title, {\n            value: \"S\\xE9lectionnez votre secteur d'activit\\xE9\",\n            type: \"h2\",\n            font: \"roboto-medium\",\n            align: \"left\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"headerEtape2 Prest-category\",\n            children: [(sellerDetails.category === \"decorations\" || sellerDetails.category.length === 0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: sellerDetails.category === \"decorations\" ? \"category active\" : \"category\",\n              onClick: () => handleCategoryChange(\"decorations\", \"fleuristes\"),\n              children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                children: \"D\\xE9corations\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 292,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 17\n            }, this), (sellerDetails.category === \"ambiance\" || sellerDetails.category.length === 0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: sellerDetails.category === \"ambiance\" ? \"category active\" : \"category\",\n              onClick: () => handleCategoryChange(\"ambiance\", \"spectacle\"),\n              children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                children: \"Ambiance/Activit\\xE9\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 306,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 17\n            }, this), (sellerDetails.category === \"nourriture\" || sellerDetails.category.length === 0) && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: sellerDetails.category === \"nourriture\" ? \"category active\" : \"category\",\n              onClick: () => handleCategoryChange(\"nourriture\", \"service\"),\n              children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                children: \"Nourriture et boisson\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 320,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 17\n            }, this), sellerDetails.category.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"category button\",\n              children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                onClick: () => setSellerDetails({ ...sellerDetails,\n                  category: \"\",\n                  subcategory: \"\"\n                }),\n                children: \"Modifier ma s\\xE9lection\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"subHeaderEtape2 Prest-subCategory\",\n            children: sellerDetails.category.length > 1 && Object.entries(items[sellerDetails.category]).map(([key, item]) => {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: sellerDetails.subcategory === key ? \"subMenuItem active\" : \"subMenuItem\",\n                onClick: () => handleSubCategoryChange(key),\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  alt: \"\",\n                  src: item.icon\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 365,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: key\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 366,\n                  columnNumber: 25\n                }, this)]\n              }, key, true, {\n                fileName: _jsxFileName,\n                lineNumber: 356,\n                columnNumber: 23\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Prest-Step1-Section3\",\n          children: [/*#__PURE__*/_jsxDEV(Title, {\n            value: \"Photo principale\",\n            type: \"h2\",\n            font: \"roboto-medium\",\n            align: \"left\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 13\n          }, this), (error.type === \"imageSize\" || error.type === \"imageType\") && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"errorMessage\",\n            children: error.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"De votre boutique ou bien de votre stand, quelque chose de repr\\xE9sentatif !\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 386,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"fileInputContainer\",\n            children: [sellerDetails.image_path.length === 0 && seller.image_path.length === 0 && /*#__PURE__*/_jsxDEV(\"label\", {\n              for: \"file\",\n              className: \"label-file\",\n              children: \"+\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 393,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              accept: \"image/jpeg, image/jpg, image/png\",\n              id: \"file\",\n              className: \"input-file\",\n              type: \"file\",\n              onChange: e => handleChange(e)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 397,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n              alt: \"\",\n              src: sellerDetails.image_path.url || seller.image_path.url\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 404,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"fileInputRight\",\n              children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"2Mo max.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 409,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"Type de fichiers accept\\xE9s : jpeg, jpg, PNG\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 410,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(ButtonSmall, {\n                onClick: () => document.getElementById(\"file\").click(),\n                color: sellerDetails.image_path.length === 0 ? \"grey\" : \"blue\",\n                value: sellerDetails.image_path.length === 0 ? \"Choisir une image\" : \"Changer d'image\",\n                marginTop: \"10px\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 411,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 390,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"Prest-Step1-Section4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Attention: \"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 430,\n                columnNumber: 17\n              }, this), \"Merci de bien v\\xE9rifier toutes vos informations, celles-ci seront modifiables seulement si votre dossier est en attente de validation.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 429,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 428,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(ButtonLarge, {\n              onClick: () => handleSendForm(),\n              color: \"orange\",\n              value: buttonLoading ? /*#__PURE__*/_jsxDEV(ReactLoading, {\n                className: \"loadingSpinnerButton\",\n                type: \"spin\",\n                color: \"white\",\n                height: 23,\n                width: 23\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 441,\n                columnNumber: 21\n              }, this) : \"Passer à l'étape suivante\",\n              width: \"400px\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 11\n        }, this), error.message.length > 1 && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"PrestErrorMessage\",\n          children: error.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 458,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 222,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Prest_Step1, \"pucHIrc1cs/9LENRft+Ms+eW7KE=\", false, function () {\n  return [useFirebase, useLocation, useAuth, useHistory];\n});\n\n_c = Prest_Step1;\nexport default Prest_Step1;\n\nvar _c;\n\n$RefreshReg$(_c, \"Prest_Step1\");","map":{"version":3,"sources":["C:/Users/Home/Desktop/Boulot/Nivid/src/pages/Prest_Step1.js"],"names":["React","useState","useEffect","useHistory","useAuth","ButtonSmall","ButtonLarge","Layout","Title","SubTitle","items","useFirebase","ReactLoading","CSSTransition","useLocation","Prest_Step1","firebaseContext","storage","error","setError","type","message","buttonLoading","setButtonLoading","isMounted","setIsMounted","search","session_id","URLSearchParams","get","initialSellerDetails","description","category","subcategory","image_path","initialPictures","name","url","lastModified","size","webkitRelativePath","sellerDetails","setSellerDetails","pictures","setPictures","setCurrentStepProcess","setImageSellerDB","addSellerDescription","seller","deleteOldSellerPicture","checkoutCheck","refSellers","setSeller","history","status","push","then","res","doc","uid","update","subscription_id","id","console","log","handleCategoryChange","handleSubCategoryChange","key","handleChange","e","target","files","URL","createObjectURL","isFormValid","length","handleSendForm","valid","tokenAndUrl","token","Math","random","toString","substr","handleUploadFile","Promise","resolve","reject","upload","ref","put","on","snapshot","child","getDownloadURL","catch","value","Object","entries","map","item","icon","document","getElementById","click"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport \"../styles/Prest_.css\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { useAuth } from \"../context/userContext\"; // context\r\n\r\nimport { ButtonSmall, ButtonLarge } from \"../components/utilities/Buttons\";\r\nimport Layout from \"../components/utilities/Layout\";\r\nimport Title from \"../components/utilities/Title\";\r\nimport SubTitle from \"../components/utilities/SubTitle\";\r\nimport { items } from \"../components/servicesData\";\r\nimport { useFirebase } from \"../assets/base-context\";\r\nimport ReactLoading from \"react-loading\";\r\nimport { CSSTransition } from \"react-transition-group\";\r\nimport { useLocation } from \"react-router-dom\";\r\n\r\nconst Prest_Step1 = () => {\r\n  const firebaseContext = useFirebase();\r\n  const storage = firebaseContext.storage();\r\n\r\n  const [error, setError] = useState({ type: \"\", message: \"\" });\r\n  const [buttonLoading, setButtonLoading] = useState(false);\r\n\r\n  const [isMounted, setIsMounted] = useState(false);\r\n\r\n  const search = useLocation().search;\r\n  const session_id = new URLSearchParams(search).get(\"session_id\");\r\n\r\n  const initialSellerDetails = {\r\n    description: \"\",\r\n    category: \"\",\r\n    subcategory: \"\",\r\n    image_path: \"\",\r\n  };\r\n\r\n  const initialPictures = {\r\n    name: \"\",\r\n    url: \"\",\r\n    lastModified: 0,\r\n    size: 0,\r\n    type: \"\",\r\n    webkitRelativePath: \"\",\r\n  };\r\n\r\n  const [sellerDetails, setSellerDetails] = useState(initialSellerDetails);\r\n\r\n  const [pictures, setPictures] = useState(initialPictures);\r\n\r\n  const {\r\n    setCurrentStepProcess,\r\n    setImageSellerDB,\r\n    addSellerDescription,\r\n    seller,\r\n    deleteOldSellerPicture,\r\n    checkoutCheck,\r\n    refSellers,\r\n    setSeller\r\n  } = useAuth(); // context\r\n  const history = useHistory();\r\n\r\n  seller.status !== \"subscribing\" && history.push(\"/mon-compte-partenaire\");\r\n\r\n  setCurrentStepProcess(1);\r\n\r\n  useEffect(() => {\r\n    setSellerDetails({\r\n      description: seller.description,\r\n      category: seller.category,\r\n      subcategory: seller.subcategory,\r\n      image_path: seller.image_path,\r\n    });\r\n    return setIsMounted(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (session_id) {\r\n      checkoutCheck(session_id).then((res) => {\r\n        if (res.status === \"paid\") {\r\n            refSellers.doc(seller.uid).update({\r\n              subscription_id: res.id,\r\n            });\r\n            setSeller({...seller, subscription_id: res.id})\r\n        }\r\n        else history.push(\"/mon-compte-partenaire/process/abonnement\");\r\n      });\r\n    }\r\n  }, []);\r\n  \r\n  useEffect(() => {\r\n      console.log(session_id)\r\n      if (!seller.subscription_id && session_id === null) history.push(\"/mon-compte-partenaire/process/abonnement\");\r\n  }, []);\r\n\r\n  function handleCategoryChange(category, subcategory) {\r\n    if (category !== sellerDetails.category) {\r\n      setSellerDetails({\r\n        ...sellerDetails,\r\n        category: category,\r\n        subcategory: subcategory,\r\n      });\r\n    }\r\n  }\r\n\r\n  function handleSubCategoryChange(key) {\r\n    if (key !== sellerDetails.subcategory) {\r\n      setSellerDetails({ ...sellerDetails, subcategory: key });\r\n    }\r\n  }\r\n\r\n  function handleChange(e) {\r\n    const type = e.target.files[0].type;\r\n    const size = e.target.files[0].size;\r\n    if (type !== \"image/png\" && type !== \"image/jpeg\" && type !== \"image/jpg\") {\r\n      setError({\r\n        type: \"imageType\",\r\n        message: \"Votre fichier n'est ni une image jpeg, jpg ou PNG.\",\r\n      });\r\n    } else if (size > 2000000) {\r\n      setError({ type: \"imageSize\", message: \"Votre image fait plus de 2Mo.\" });\r\n    } else {\r\n      setPictures(e.target.files[0]);\r\n      setSellerDetails({\r\n        ...sellerDetails,\r\n        image_path: { url: URL.createObjectURL(e.target.files[0]) },\r\n      });\r\n      setError({ type: \"\", message: \"\" });\r\n    }\r\n  }\r\n\r\n  async function isFormValid() {\r\n    if (sellerDetails.description.length > 350) {\r\n      if (\r\n        sellerDetails.category.length > 1 &&\r\n        sellerDetails.subcategory.length > 1\r\n      ) {\r\n        if (\r\n          (pictures.name && pictures.name.length > 0) ||\r\n          (sellerDetails.image_path && sellerDetails.image_path.url.length) > 0\r\n        ) {\r\n          return true;\r\n        } else {\r\n          setButtonLoading(false);\r\n          setError({\r\n            type: \"noImage\",\r\n            message: \"Vous devez ajouter une image.\",\r\n          });\r\n        }\r\n      } else {\r\n        setButtonLoading(false);\r\n        setError({\r\n          type: \"noCategory\",\r\n          message: \"Vous devez séléctionner votre secteur d'activité.\",\r\n        });\r\n      }\r\n    } else {\r\n      setButtonLoading(false);\r\n      setError({\r\n        type: \"description\",\r\n        message: \"Votre description doit faire au moins 350 caractères.\",\r\n      });\r\n    }\r\n  }\r\n\r\n  async function handleSendForm() {\r\n    setButtonLoading(true);\r\n    setError({ type: \"\", message: \"\" });\r\n    const valid = await isFormValid();\r\n    if (valid === true) {\r\n      let tokenAndUrl = { url: \"\", token: \"\" };\r\n\r\n      // Si la photo est une nouvelle\r\n      if (pictures.name.length > 0) {\r\n        const token = Math.random().toString(36).substr(2, 19);\r\n        const url = await handleUploadFile(token);\r\n        await setImageSellerDB(url, token);\r\n        tokenAndUrl = { url: url, token: token };\r\n        seller.image_path.url &&\r\n          deleteOldSellerPicture([seller.image_path.token]);\r\n      } else {\r\n        tokenAndUrl = sellerDetails.image_path; // Photo non changée\r\n      }\r\n\r\n      addSellerDescription(sellerDetails, tokenAndUrl).then(() => {\r\n        setPictures(initialPictures);\r\n        setSellerDetails({ ...sellerDetails, image_path: tokenAndUrl });\r\n        setButtonLoading(false);\r\n        history.push(\"/mon-compte-partenaire/process/services\");\r\n      });\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  async function handleUploadFile(token) {\r\n    return new Promise((resolve, reject) => {\r\n      const upload = storage.ref(`sellers/${token}`).put(pictures);\r\n      upload.on(\r\n        \"state_changed\",\r\n        (snapshot) => {},\r\n        (error) => {\r\n          console.log(error);\r\n        },\r\n        () => {\r\n          storage\r\n            .ref(\"sellers\")\r\n            .child(token)\r\n            .getDownloadURL()\r\n            .then((url) => {\r\n              resolve(url);\r\n            })\r\n            .catch((error) => {\r\n              console.error(error);\r\n              reject(error);\r\n            });\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  console.log(sellerDetails);\r\n\r\n  return (\r\n    <Layout>\r\n      <CSSTransition\r\n        in={isMounted}\r\n        timeout={300}\r\n        classNames=\"pageTransition\"\r\n        unmountOnExit\r\n      >\r\n        <div>\r\n          <SubTitle\r\n            value=\"Dites-nous en plus sur votre activité\"\r\n            type=\"big\"\r\n            font=\"roboto-medium\"\r\n            align=\"left\"\r\n          />\r\n\r\n          <div className=\"Prest-Step1-Section1\">\r\n            <Title\r\n              value=\"Description de votre prestation\"\r\n              type=\"h2\"\r\n              font=\"roboto-medium\"\r\n              align=\"left\"\r\n            />\r\n            <p>\r\n              Décrivez en détail votre entreprise : aussi bien les services que\r\n              les produits proposés afin de renseigner au mieux vos futurs\r\n              clients. Notre équipe de journalistes révisera votre texte afin\r\n              d'optimiser votre vitrine et vous permettre d'attirer le plus\r\n              grand nombre de clients. Merci de ne pas inclure de page web,\r\n              courrier électronique, numéro de téléphone et autres coordonnées\r\n              de contact.\r\n            </p>\r\n            <div className=\"textAreaContainer\">\r\n              <textarea\r\n                value={sellerDetails.description}\r\n                onChange={(e) =>\r\n                  setSellerDetails({\r\n                    ...sellerDetails,\r\n                    description: e.target.value,\r\n                  })\r\n                }\r\n              ></textarea>\r\n              <span\r\n                className={sellerDetails.description.length > 349 && \"valid\"}\r\n              >\r\n                {sellerDetails.description.length}/350\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Prest-Step1-Section2\">\r\n            <Title\r\n              value=\"Sélectionnez votre secteur d'activité\"\r\n              type=\"h2\"\r\n              font=\"roboto-medium\"\r\n              align=\"left\"\r\n            />\r\n\r\n            <div className=\"headerEtape2 Prest-category\">\r\n              {(sellerDetails.category === \"decorations\" ||\r\n                sellerDetails.category.length === 0) && (\r\n                <div\r\n                  className={\r\n                    sellerDetails.category === \"decorations\"\r\n                      ? \"category active\"\r\n                      : \"category\"\r\n                  }\r\n                  onClick={() =>\r\n                    handleCategoryChange(\"decorations\", \"fleuristes\")\r\n                  }\r\n                >\r\n                  <h1>Décorations</h1>\r\n                </div>\r\n              )}\r\n\r\n              {(sellerDetails.category === \"ambiance\" ||\r\n                sellerDetails.category.length === 0) && (\r\n                <div\r\n                  className={\r\n                    sellerDetails.category === \"ambiance\"\r\n                      ? \"category active\"\r\n                      : \"category\"\r\n                  }\r\n                  onClick={() => handleCategoryChange(\"ambiance\", \"spectacle\")}\r\n                >\r\n                  <h1>Ambiance/Activité</h1>\r\n                </div>\r\n              )}\r\n\r\n              {(sellerDetails.category === \"nourriture\" ||\r\n                sellerDetails.category.length === 0) && (\r\n                <div\r\n                  className={\r\n                    sellerDetails.category === \"nourriture\"\r\n                      ? \"category active\"\r\n                      : \"category\"\r\n                  }\r\n                  onClick={() => handleCategoryChange(\"nourriture\", \"service\")}\r\n                >\r\n                  <h1>Nourriture et boisson</h1>\r\n                </div>\r\n              )}\r\n\r\n              {/* {\r\n                                (sellerDetails.category === \"service\" || sellerDetails.category.length === 0) &&\r\n                                <div\r\n                                    className={sellerDetails.category === \"service\" ? \"category active\" : \"category\"}\r\n                                    onClick={() => handleCategoryChange(\"service\", \"serveurs\")}\r\n                                >\r\n                                    <h1>Service sur place</h1>\r\n                                </div>\r\n                            } */}\r\n\r\n              {sellerDetails.category.length > 0 && (\r\n                <div className=\"category button\">\r\n                  <h1\r\n                    onClick={() =>\r\n                      setSellerDetails({\r\n                        ...sellerDetails,\r\n                        category: \"\",\r\n                        subcategory: \"\",\r\n                      })\r\n                    }\r\n                  >\r\n                    Modifier ma sélection\r\n                  </h1>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"subHeaderEtape2 Prest-subCategory\">\r\n              {sellerDetails.category.length > 1 &&\r\n                Object.entries(items[sellerDetails.category]).map(\r\n                  ([key, item]) => {\r\n                    return (\r\n                      <div\r\n                        key={key}\r\n                        className={\r\n                          sellerDetails.subcategory === key\r\n                            ? \"subMenuItem active\"\r\n                            : \"subMenuItem\"\r\n                        }\r\n                        onClick={() => handleSubCategoryChange(key)}\r\n                      >\r\n                        <img alt=\"\" src={item.icon} />\r\n                        <p>{key}</p>\r\n                      </div>\r\n                    );\r\n                  }\r\n                )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Prest-Step1-Section3\">\r\n            <Title\r\n              value=\"Photo principale\"\r\n              type=\"h2\"\r\n              font=\"roboto-medium\"\r\n              align=\"left\"\r\n            />\r\n\r\n            {(error.type === \"imageSize\" || error.type === \"imageType\") && (\r\n              <p className=\"errorMessage\">{error.message}</p>\r\n            )}\r\n\r\n            <p>\r\n              De votre boutique ou bien de votre stand, quelque chose de\r\n              représentatif !\r\n            </p>\r\n            <div className=\"fileInputContainer\">\r\n              {sellerDetails.image_path.length === 0 &&\r\n                seller.image_path.length === 0 && (\r\n                  <label for=\"file\" className=\"label-file\">\r\n                    +\r\n                  </label>\r\n                )}\r\n              <input\r\n                accept=\"image/jpeg, image/jpg, image/png\"\r\n                id=\"file\"\r\n                className=\"input-file\"\r\n                type=\"file\"\r\n                onChange={(e) => handleChange(e)}\r\n              />\r\n              <img\r\n                alt=\"\"\r\n                src={sellerDetails.image_path.url || seller.image_path.url}\r\n              />\r\n              <div className=\"fileInputRight\">\r\n                <p>2Mo max.</p>\r\n                <p>Type de fichiers acceptés : jpeg, jpg, PNG</p>\r\n                <ButtonSmall\r\n                  onClick={() => document.getElementById(\"file\").click()}\r\n                  color={\r\n                    sellerDetails.image_path.length === 0 ? \"grey\" : \"blue\"\r\n                  }\r\n                  value={\r\n                    sellerDetails.image_path.length === 0\r\n                      ? \"Choisir une image\"\r\n                      : \"Changer d'image\"\r\n                  }\r\n                  marginTop=\"10px\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"Prest-Step1-Section4\">\r\n            <div>\r\n              <p>\r\n                <span>Attention: </span>Merci de bien vérifier toutes vos\r\n                informations, celles-ci seront modifiables seulement si votre\r\n                dossier est en attente de validation.\r\n              </p>\r\n            </div>\r\n            <div>\r\n              <ButtonLarge\r\n                onClick={() => handleSendForm()}\r\n                color=\"orange\"\r\n                value={\r\n                  buttonLoading ? (\r\n                    <ReactLoading\r\n                      className=\"loadingSpinnerButton\"\r\n                      type=\"spin\"\r\n                      color=\"white\"\r\n                      height={23}\r\n                      width={23}\r\n                    />\r\n                  ) : (\r\n                    \"Passer à l'étape suivante\"\r\n                  )\r\n                }\r\n                width=\"400px\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {error.message.length > 1 && (\r\n            <p className=\"PrestErrorMessage\">{error.message}</p>\r\n          )}\r\n        </div>\r\n      </CSSTransition>\r\n    </Layout>\r\n  );\r\n};\r\nexport default Prest_Step1;\r\n"]},"metadata":{},"sourceType":"module"}