{"ast":null,"code":"import _toConsumableArray from\"/Users/bc/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/bc/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/bc/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/bc/Desktop/Nivid/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useState,useEffect}from'react';import{useAuth}from'../context/userContext';import{CSSTransition}from'react-transition-group';import Loader from'./Loader';import ModalYesNo from'./utilities/ModalYesNo';import Title from'./utilities/Title';import SubTitle from'./utilities/SubTitle';import{ButtonSmall}from'./utilities/Buttons';import Image from'../components/utilities/Image';import PrintIcon from'@mui/icons-material/Print';import{FaChevronDown}from'react-icons/fa';import IconButton from'@mui/material/IconButton';import Fade from'@mui/material/Fade';var Prest_Dashboard_Commandes=function Prest_Dashboard_Commandes(){var _useAuth=useAuth(),seller=_useAuth.seller,getSalesOfSellerIdFromDB=_useAuth.getSalesOfSellerIdFromDB,formateToDateWithWords=_useAuth.formateToDateWithWords,formateToDate=_useAuth.formateToDate,formatLabelTimePicker=_useAuth.formatLabelTimePicker,updateSaleStatusInDB=_useAuth.updateSaleStatusInDB,updateSaleNote=_useAuth.updateSaleNote,sendInBlue_sendBillRequestToAdmin=_useAuth.sendInBlue_sendBillRequestToAdmin;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),openedEvent=_useState2[0],setOpenedEvent=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),sales=_useState4[0],setSales=_useState4[1];var _useState5=useState({saleID:0,message:\"\"}),_useState6=_slicedToArray(_useState5,2),noteObj=_useState6[0],setNoteObj=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isModalOpened=_useState8[0],setIsModalOpened=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),currentKey=_useState10[0],setCurrentKey=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),filterStatus=_useState12[0],setFilterStatus=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),filterYear=_useState14[0],setFilterYear=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isBillEmailSent=_useState16[0],setIsBillEmailSent=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isMounted=_useState18[0],setIsMounted=_useState18[1];useEffect(function(){getSales().then(function(){setIsMounted(true);});},[]);function getSales(){return _getSales.apply(this,arguments);}function _getSales(){_getSales=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var salesList;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getSalesOfSellerIdFromDB(seller.uid);case 2:salesList=_context.sent;return _context.abrupt(\"return\",setSales(salesList));case 4:case\"end\":return _context.stop();}}},_callee);}));return _getSales.apply(this,arguments);}function handleActionSale(_x,_x2){return _handleActionSale.apply(this,arguments);}function _handleActionSale(){_handleActionSale=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(key,status){var sale,newSales;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(status===\"rejected\")){_context2.next=6;break;}setIsModalOpened(true);setCurrentKey(key);return _context2.abrupt(\"return\");case 6:sale=sales.filter(function(sale){return sale.id===key;});sale[0].status=status;newSales=sales.filter(function(sale){return sale.id!==key;});newSales=[].concat(_toConsumableArray(newSales),[sale[0]]);_context2.next=12;return updateSaleStatusInDB(sale[0].id,sale[0].sellerID,status);case 12:return _context2.abrupt(\"return\",setSales(newSales));case 13:case\"end\":return _context2.stop();}}},_callee2);}));return _handleActionSale.apply(this,arguments);}function handleModalYesNoReturn(_x3){return _handleModalYesNoReturn.apply(this,arguments);}function _handleModalYesNoReturn(){_handleModalYesNoReturn=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(val){var sale,newSales;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setIsModalOpened(false);if(!(val===\"no\")){_context3.next=3;break;}return _context3.abrupt(\"return\");case 3:sale=sales.filter(function(sale){return sale.id===currentKey;});sale[0].status=\"rejected\";newSales=sales.filter(function(sale){return sale.id!==currentKey;});newSales=[].concat(_toConsumableArray(newSales),[sale[0]]);_context3.next=9;return updateSaleStatusInDB(sale[0].id,sale[0].sellerID,\"rejected\");case 9:return _context3.abrupt(\"return\",setSales(newSales));case 10:case\"end\":return _context3.stop();}}},_callee3);}));return _handleModalYesNoReturn.apply(this,arguments);}function handleChangeNote(saleID,value){setNoteObj({saleID:saleID,message:value});}function handleSaveNote(_x4){return _handleSaveNote.apply(this,arguments);}function _handleSaveNote(){_handleSaveNote=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(eventID){var newSale,newSaleList;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:newSaleList=_toConsumableArray(sales);sales.forEach(function(sale,key){if(sale.eventID===eventID){newSale=sale;newSale.note=noteObj.message;newSaleList[key]=newSale;}});_context4.next=4;return updateSaleNote(noteObj.saleID,noteObj.message);case 4:setSales(newSaleList);return _context4.abrupt(\"return\");case 6:case\"end\":return _context4.stop();}}},_callee4);}));return _handleSaveNote.apply(this,arguments);}function handleOpeningSale(key){if(openedEvent===key){setOpenedEvent(\"\");setNoteObj({saleID:0,message:\"\"});}else{setOpenedEvent(key);var newSale={};sales.forEach(function(sale){if(sale.id===key){newSale=sale;}});setNoteObj({saleID:key,message:newSale.note});}}function getStartYearMinus(val){var yearWanted=new Date(new Date().setFullYear(new Date().getFullYear()-val));yearWanted=yearWanted.getFullYear();var dateWanted=new Date(yearWanted,0,1);return dateWanted.getTime();}function getEndYearMinus(val){var yearWanted=new Date(new Date().setFullYear(new Date().getFullYear()-val));yearWanted=yearWanted.getFullYear();var dateWanted=new Date(yearWanted,12,31);return dateWanted.getTime();}function handlePrintClicked(transcationID,sellerID){sendInBlue_sendBillRequestToAdmin(transcationID,sellerID).then(function(res){if(res===true){setIsBillEmailSent(true);setTimeout(function(){setIsBillEmailSent(false);},2000);}});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(CSSTransition,{in:!isMounted,timeout:300,classNames:\"pageTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsx(Loader,{})}),/*#__PURE__*/_jsx(CSSTransition,{in:isMounted,timeout:300,classNames:\"pageTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsxs(\"div\",{className:\"prest_Dashboard_Commandes\",children:[/*#__PURE__*/_jsx(\"section\",{className:\"prest_dashboard_header\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(SubTitle,{type:\"big\",font:\"roboto-bold\",value:\"Commandes re\\xE7ues\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Vos commandes r\\xE9centes s'afficheront ici, ne s'afficherint que celle de l'ann\\xE9e en cours.\",/*#__PURE__*/_jsx(\"br\",{}),\"Si vous avez besoin de voit vos commandes archiv\\xE9es, vous pourrez y acc\\xE9der en filtrant les commandes \\xE0 afficher dans la liste ci-dessous.\"]})]})}),/*#__PURE__*/_jsxs(\"section\",{className:\"prest_dashboard_commandes_list\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"prest_dashboard_commandes_list__header\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Filtrer par:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"filterBloc\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filterField year\",children:[\"Ann\\xE9e \",/*#__PURE__*/_jsx(FaChevronDown,{})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filterOptions year\",children:[/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterYear(0);},children:new Date().getFullYear()}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterYear(1);},children:new Date().getFullYear()-1}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterYear(2);},children:new Date().getFullYear()-2}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterYear(3);},children:new Date().getFullYear()-3})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filterBloc\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filterField year\",children:[\"Statut \",/*#__PURE__*/_jsx(FaChevronDown,{})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filterOptions year\",children:[/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterStatus(\"\");},children:\"Tous\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterStatus(\"validated\");},children:\"Valid\\xE9\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterStatus(\"rejected\");},children:\"Rejet\\xE9\"}),/*#__PURE__*/_jsx(\"div\",{onClick:function onClick(){return setFilterStatus(\"pending\");},children:\"En attente\"})]})]})]})}),sales.filter(function(sale){return sale.date>getStartYearMinus(filterYear)&&sale.date<getEndYearMinus(filterYear);}).filter(function(sale){return filterStatus.length>0?sale.status===filterStatus:sale.status.length>0;}).sort(function(a,b){return b.date-a.date;}).map(function(sale,key){return/*#__PURE__*/_jsxs(\"div\",{className:\"prest_dashboard_commandes_list__item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item__header\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"commandTitle\",children:[\"Commande #\",sale.id,\" - \",/*#__PURE__*/_jsx(\"span\",{children:formateToDate(sale.date)}),sale.status===\"validated\"&&/*#__PURE__*/ // Traitement à changer, je lemet comme ça pour qu'il soit visible \n// de Léo, mais ensuite on devra ne l'afficher que sur c'est à \"passed\"\n_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IconButton,{onClick:function onClick(){return handlePrintClicked(sale.transactionID,sale.sellerID);},\"aria-label\":\"bill\",children:/*#__PURE__*/_jsx(PrintIcon,{})}),/*#__PURE__*/_jsx(Fade,{in:isBillEmailSent,children:/*#__PURE__*/_jsx(\"div\",{className:\"confirmBox_print\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Votre demande de facture a bien \\xE9t\\xE9 prise en compte, vous recevrez un mail d'ici peu.\"})})})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"blueLink\",onClick:function onClick(){return handleOpeningSale(sale.id);},children:openedEvent===sale.id?\"Fermer les détails de la commande\":\"Voir les détails de la commande\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"commandTitle\",children:[\"Montant de la commande : \",/*#__PURE__*/_jsxs(\"span\",{children:[sale.total,\"\\u20AC\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item__content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"item__content__left imagesSuperpos \".concat(openedEvent===sale.id&&\"closed\"),children:sale.choosedServices.slice(0,3).map(function(service){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Image,{url:service.image})});})}),/*#__PURE__*/_jsxs(\"div\",{className:\"item__content__right \".concat(sale.status),children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Date de l'\\xE9v\\xE8nement :\"}),/*#__PURE__*/_jsx(\"p\",{children:formateToDateWithWords(sale.eventDate)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nombre de personne :\"}),/*#__PURE__*/_jsxs(\"p\",{children:[sale.people,\" personnes\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Cr\\xE9neau :\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Commence \\xE0 \",/*#__PURE__*/_jsx(\"span\",{children:formatLabelTimePicker(sale.startAt)}),\" & se termine \\xE0 \",/*#__PURE__*/_jsx(\"span\",{children:formatLabelTimePicker(sale.endAt)})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Nombre de m\\xB2 :\"}),/*#__PURE__*/_jsxs(\"p\",{children:[sale.placeSize,\"m\\xB2\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:openedEvent===sale.id?\"item__details active\":\"item__details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"item__details__services__list\",children:sale.choosedServices.map(function(service,key){return/*#__PURE__*/_jsxs(\"div\",{className:\"item__details__services__item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"services__item__left\",children:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"img\",{src:service.image,alt:\"\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"services__item__right\",children:[/*#__PURE__*/_jsx(\"p\",{children:service.name}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"price\",children:[service.price,\"\\u20AC\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"quantity\",children:[\"x\",service.quantity]})]})]})]},key);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"item__details__note\",children:[/*#__PURE__*/_jsx(Title,{type:\"h2\",font:\"roboto-bold\",value:\"Ajouter une note pense-b\\xEAte\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Si vous avez besoin de noter quelque chose \\xE0 ne pas oublier concernant cette commande, c'est ici.\"}),/*#__PURE__*/_jsx(\"textarea\",{value:noteObj.message,onChange:function onChange(e){return handleChangeNote(sale.id,e.target.value);}}),noteObj.message!==sale.note&&/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleSaveNote(sale.eventID);},color:\"blue\",value:\"Sauvegarder\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item__bottom\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item__bottom__left\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Reste \\xE0 payer \\xE0 charge du client : \",sale.paid!==sale.total?(sale.total*0.7).toFixed(2):0,\"\\u20AC\"]}),/*#__PURE__*/_jsx(\"span\",{children:\"Ce montant sera r\\xE9gl\\xE9 2 jours avant le d\\xE9but de l'\\xE9v\\xE8nement\"})]}),/*#__PURE__*/_jsx(CSSTransition,{in:sale.status!==\"pending\",timeout:0,classNames:\"opacityTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsx(\"div\",{className:\"item__bottom__center\",children:/*#__PURE__*/_jsxs(\"p\",{className:sale.status,children:[\"Statut : \",/*#__PURE__*/_jsx(\"span\",{children:sale.status===\"validated\"?\"Validé\":\"Refusé\"})]})})}),sale.status===\"pending\"&&/*#__PURE__*/_jsxs(\"div\",{className:\"item__bottom__right\",children:[/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleActionSale(sale.id,\"rejected\");},color:\"red\",value:\"Refuser la commande\"}),/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleActionSale(sale.id,\"validated\");},color:\"green\",value:\"Accepter la commande\"})]}),/*#__PURE__*/_jsx(CSSTransition,{in:sale.status===\"validated\",timeout:200,classNames:\"fromLeftTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsx(ButtonSmall,{onClick:function onClick(){return handleActionSale(sale.id,\"rejected\");},color:\"red\",value:\"Annuler la commmande\"})})]}),/*#__PURE__*/_jsx(CSSTransition,{in:isModalOpened,timeout:200,classNames:\"pageTransition\",unmountOnExit:true,children:/*#__PURE__*/_jsx(ModalYesNo,{callback:function callback(val){return handleModalYesNoReturn(val);},value:\"L'annulation d'une commande est irr\\xE9versible.\"})})]},key);})]})]})})]});};export default Prest_Dashboard_Commandes;","map":{"version":3,"sources":["/Users/bc/Desktop/Nivid/src/components/Prest_Dashboard_Commandes.js"],"names":["React","useState","useEffect","useAuth","CSSTransition","Loader","ModalYesNo","Title","SubTitle","ButtonSmall","Image","PrintIcon","FaChevronDown","IconButton","Fade","Prest_Dashboard_Commandes","seller","getSalesOfSellerIdFromDB","formateToDateWithWords","formateToDate","formatLabelTimePicker","updateSaleStatusInDB","updateSaleNote","sendInBlue_sendBillRequestToAdmin","openedEvent","setOpenedEvent","sales","setSales","saleID","message","noteObj","setNoteObj","isModalOpened","setIsModalOpened","currentKey","setCurrentKey","filterStatus","setFilterStatus","filterYear","setFilterYear","isBillEmailSent","setIsBillEmailSent","isMounted","setIsMounted","getSales","then","uid","salesList","handleActionSale","key","status","sale","filter","id","newSales","sellerID","handleModalYesNoReturn","val","handleChangeNote","value","handleSaveNote","eventID","newSaleList","forEach","newSale","note","handleOpeningSale","getStartYearMinus","yearWanted","Date","setFullYear","getFullYear","dateWanted","getTime","getEndYearMinus","handlePrintClicked","transcationID","res","setTimeout","date","length","sort","a","b","map","transactionID","total","choosedServices","slice","service","image","eventDate","people","startAt","endAt","placeSize","name","price","quantity","e","target","paid","toFixed"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { useAuth } from '../context/userContext'\r\nimport { CSSTransition } from 'react-transition-group'\r\n\r\nimport Loader from './Loader'\r\nimport ModalYesNo from './utilities/ModalYesNo'\r\n\r\nimport Title from './utilities/Title'\r\nimport SubTitle from './utilities/SubTitle'\r\nimport { ButtonSmall } from './utilities/Buttons'\r\nimport Image from '../components/utilities/Image'\r\nimport PrintIcon from '@mui/icons-material/Print';\r\nimport { FaChevronDown } from 'react-icons/fa';\r\nimport IconButton from '@mui/material/IconButton';\r\n\r\nimport Fade from '@mui/material/Fade';\r\n\r\nconst Prest_Dashboard_Commandes = () => {\r\n\r\n    const {\r\n        seller,\r\n        getSalesOfSellerIdFromDB,\r\n        formateToDateWithWords,\r\n        formateToDate,\r\n        formatLabelTimePicker,\r\n        updateSaleStatusInDB,\r\n        updateSaleNote,\r\n        sendInBlue_sendBillRequestToAdmin\r\n    } = useAuth()\r\n\r\n    const [openedEvent, setOpenedEvent] = useState(\"\")\r\n    const [sales, setSales] = useState([]);\r\n    const [noteObj, setNoteObj] = useState({ saleID: 0, message: \"\" });\r\n    const [isModalOpened, setIsModalOpened] = useState(false);\r\n    const [currentKey, setCurrentKey] = useState();\r\n\r\n    const [filterStatus, setFilterStatus] = useState(\"\");\r\n    const [filterYear, setFilterYear] = useState(0);\r\n\r\n    const [isBillEmailSent, setIsBillEmailSent] = useState(false);\r\n\r\n    const [isMounted, setIsMounted] = useState(false);\r\n\r\n    useEffect(() => {\r\n        getSales().then(() => {\r\n            setIsMounted(true)\r\n        })\r\n    }, [])\r\n\r\n    async function getSales() {\r\n        const salesList = await getSalesOfSellerIdFromDB(seller.uid)\r\n        return setSales(salesList)\r\n    }\r\n\r\n    async function handleActionSale(key, status) {\r\n        if (status === \"rejected\") {\r\n            setIsModalOpened(true)\r\n            setCurrentKey(key)\r\n            return\r\n        }\r\n        else {\r\n            let sale = sales.filter(sale => sale.id === key)\r\n            sale[0].status = status\r\n            let newSales = sales.filter(sale => sale.id !== key)\r\n            newSales = [...newSales, sale[0]]\r\n            await updateSaleStatusInDB(sale[0].id, sale[0].sellerID, status)\r\n            return setSales(newSales)\r\n        }\r\n\r\n    }\r\n\r\n    async function handleModalYesNoReturn(val) {\r\n        setIsModalOpened(false)\r\n        if (val === \"no\") return\r\n\r\n        let sale = sales.filter(sale => sale.id === currentKey)\r\n        sale[0].status = \"rejected\"\r\n        let newSales = sales.filter(sale => sale.id !== currentKey)\r\n        newSales = [...newSales, sale[0]]\r\n        await updateSaleStatusInDB(sale[0].id, sale[0].sellerID, \"rejected\")\r\n        return setSales(newSales)\r\n    }\r\n\r\n    function handleChangeNote(saleID, value) {\r\n        setNoteObj({ saleID, message: value })\r\n    }\r\n\r\n    async function handleSaveNote(eventID) {\r\n        let newSale\r\n        let newSaleList = [...sales]\r\n        sales.forEach((sale, key) => {\r\n            if (sale.eventID === eventID) {\r\n                newSale = sale\r\n                newSale.note = noteObj.message\r\n                newSaleList[key] = newSale\r\n            }\r\n        })\r\n        await updateSaleNote(noteObj.saleID, noteObj.message)\r\n        setSales(newSaleList)\r\n        return\r\n    }\r\n\r\n    function handleOpeningSale(key) {\r\n        if (openedEvent === key) {\r\n            setOpenedEvent(\"\")\r\n            setNoteObj({ saleID: 0, message: \"\" })\r\n        } else {\r\n            setOpenedEvent(key)\r\n            let newSale = {}\r\n            sales.forEach(sale => {\r\n                if (sale.id === key) {\r\n                    newSale = sale\r\n                }\r\n            })\r\n            setNoteObj({ saleID: key, message: newSale.note })\r\n        }\r\n    }\r\n\r\n    function getStartYearMinus(val) {\r\n        let yearWanted = new Date(new Date().setFullYear(new Date().getFullYear() - val))\r\n        yearWanted = yearWanted.getFullYear()\r\n        const dateWanted = new Date(yearWanted, 0, 1)\r\n        return dateWanted.getTime()\r\n    }\r\n\r\n    function getEndYearMinus(val) {\r\n        let yearWanted = new Date(new Date().setFullYear(new Date().getFullYear() - val))\r\n        yearWanted = yearWanted.getFullYear()\r\n        const dateWanted = new Date(yearWanted, 12, 31)\r\n        return dateWanted.getTime()\r\n    }\r\n\r\n    function handlePrintClicked(transcationID, sellerID) {\r\n        sendInBlue_sendBillRequestToAdmin(transcationID, sellerID).then(res => {\r\n            if (res === true) {\r\n                setIsBillEmailSent(true)\r\n                setTimeout(() => {\r\n                    setIsBillEmailSent(false)\r\n                }, 2000)\r\n            }\r\n        })\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <CSSTransition\r\n                in={!isMounted}\r\n                timeout={300}\r\n                classNames=\"pageTransition\"\r\n                unmountOnExit\r\n            >\r\n                <Loader />\r\n            </CSSTransition>\r\n\r\n            <CSSTransition\r\n                in={isMounted}\r\n                timeout={300}\r\n                classNames=\"pageTransition\"\r\n                unmountOnExit\r\n            >\r\n                <div className=\"prest_Dashboard_Commandes\">\r\n\r\n                    <section className=\"prest_dashboard_header\">\r\n                        <div>\r\n                            <SubTitle type=\"big\" font=\"roboto-bold\" value=\"Commandes reçues\" />\r\n                            <p>Vos commandes récentes s'afficheront ici, ne s'afficherint que celle de l'année en cours.<br />\r\n                                Si vous avez besoin de voit vos commandes archivées, vous pourrez y accéder en filtrant\r\n                                les commandes à afficher dans la liste ci-dessous.</p>\r\n                        </div>\r\n                    </section>\r\n\r\n                    <section className=\"prest_dashboard_commandes_list\">\r\n                        <div className=\"prest_dashboard_commandes_list__header\">\r\n                            <div>\r\n                                <label>Filtrer par:</label>\r\n                                <div className=\"filterBloc\">\r\n                                    <div className=\"filterField year\">Année <FaChevronDown /></div>\r\n                                    <div className=\"filterOptions year\">\r\n                                        <div onClick={() => setFilterYear(0)}>{new Date().getFullYear()}</div>\r\n                                        <div onClick={() => setFilterYear(1)}>{new Date().getFullYear() - 1}</div>\r\n                                        <div onClick={() => setFilterYear(2)}>{new Date().getFullYear() - 2}</div>\r\n                                        <div onClick={() => setFilterYear(3)}>{new Date().getFullYear() - 3}</div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"filterBloc\">\r\n                                    <div className=\"filterField year\">Statut <FaChevronDown /></div>\r\n                                    <div className=\"filterOptions year\">\r\n                                        <div onClick={() => setFilterStatus(\"\")}>Tous</div>\r\n                                        <div onClick={() => setFilterStatus(\"validated\")}>Validé</div>\r\n                                        <div onClick={() => setFilterStatus(\"rejected\")}>Rejeté</div>\r\n                                        <div onClick={() => setFilterStatus(\"pending\")}>En attente</div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        {sales\r\n                            .filter(sale => sale.date > getStartYearMinus(filterYear) && sale.date < getEndYearMinus(filterYear))\r\n                            .filter(sale => (filterStatus.length > 0 ? sale.status === filterStatus : sale.status.length > 0))\r\n                            .sort((a, b) => b.date - a.date)\r\n                            .map((sale, key) =>\r\n                                <div key={key} className=\"prest_dashboard_commandes_list__item\">\r\n                                    <div className=\"item__header\">\r\n\r\n                                        <p className=\"commandTitle\">Commande #{sale.id} - <span>{formateToDate(sale.date)}</span>\r\n                                            {(sale.status === \"validated\") &&\r\n                                                // Traitement à changer, je lemet comme ça pour qu'il soit visible \r\n                                                // de Léo, mais ensuite on devra ne l'afficher que sur c'est à \"passed\"\r\n                                                <>\r\n                                                    <IconButton onClick={() => handlePrintClicked(sale.transactionID, sale.sellerID)} aria-label=\"bill\">\r\n                                                        <PrintIcon />\r\n                                                    </IconButton>\r\n                                                    <Fade in={isBillEmailSent}>\r\n                                                        <div className=\"confirmBox_print\">\r\n                                                            <p>Votre demande de facture a bien été prise en compte, vous recevrez un mail d'ici peu.</p>\r\n                                                        </div>\r\n                                                    </Fade>\r\n                                                </>\r\n                                            }\r\n                                        </p>\r\n                                        <p className=\"blueLink\" onClick={() => handleOpeningSale(sale.id)}>\r\n                                            {openedEvent === sale.id ? \"Fermer les détails de la commande\" : \"Voir les détails de la commande\"}\r\n                                        </p>\r\n                                        <p className=\"commandTitle\">Montant de la commande : <span>{sale.total}€</span></p>\r\n                                    </div>\r\n                                    <div className=\"item__content\">\r\n\r\n                                        <div className={`item__content__left imagesSuperpos ${openedEvent === sale.id && \"closed\"}`}>\r\n                                            {sale.choosedServices.slice(0, 3).map(service =>\r\n                                                <div><Image url={service.image} /></div>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className={`item__content__right ${sale.status}`}>\r\n                                            <div>\r\n                                                <label>Date de l'évènement :</label>\r\n                                                <p>{formateToDateWithWords(sale.eventDate)}</p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label>Nombre de personne :</label>\r\n                                                <p>{sale.people} personnes</p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label>Créneau :</label>\r\n                                                <p>Commence à <span>{formatLabelTimePicker(sale.startAt)}</span> & se termine à <span>{formatLabelTimePicker(sale.endAt)}</span>\r\n                                                </p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <label>Nombre de m² :</label>\r\n                                                <p>{sale.placeSize}m²</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div\r\n                                        className={openedEvent === sale.id ? \"item__details active\" : \"item__details\"}\r\n                                    >\r\n                                        <div className=\"item__details__services__list\">\r\n                                            {sale.choosedServices.map((service, key) =>\r\n                                                <div key={key} className=\"item__details__services__item\">\r\n                                                    <div className=\"services__item__left\">\r\n                                                        <div>\r\n                                                            <img src={service.image} alt=\"\" />\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    <div className=\"services__item__right\">\r\n                                                        <p>{service.name}</p>\r\n                                                        <div>\r\n                                                            <span className=\"price\">{service.price}€</span>\r\n                                                            <span className=\"quantity\">x{service.quantity}</span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                        <div className=\"item__details__note\">\r\n                                            <Title type=\"h2\" font=\"roboto-bold\" value=\"Ajouter une note pense-bête\" />\r\n                                            <p>Si vous avez besoin de noter quelque chose à ne pas oublier concernant cette commande, c'est ici.</p>\r\n                                            <textarea value={noteObj.message} onChange={(e) => handleChangeNote(sale.id, e.target.value)}></textarea>\r\n                                            {noteObj.message !== sale.note && <ButtonSmall onClick={() => handleSaveNote(sale.eventID)} color=\"blue\" value=\"Sauvegarder\" />}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"item__bottom\">\r\n                                        <div className=\"item__bottom__left\">\r\n                                            <p>Reste à payer à charge du client : {sale.paid !== sale.total ? (sale.total * 0.7).toFixed(2) : 0}€</p>\r\n                                            <span>Ce montant sera réglé 2 jours avant le début de l'évènement</span>\r\n                                        </div>\r\n\r\n                                        <CSSTransition\r\n                                            in={sale.status !== \"pending\"}\r\n                                            timeout={0}\r\n                                            classNames=\"opacityTransition\"\r\n                                            unmountOnExit\r\n                                        >\r\n                                            <div className=\"item__bottom__center\">\r\n                                                <p className={sale.status}>\r\n                                                    Statut : <span>{sale.status === \"validated\" ? \"Validé\" : \"Refusé\"}</span>\r\n                                                </p>\r\n                                            </div>\r\n                                        </CSSTransition>\r\n                                        {sale.status === \"pending\" &&\r\n                                            <div className=\"item__bottom__right\">\r\n                                                <ButtonSmall onClick={() => handleActionSale(sale.id, \"rejected\")} color=\"red\" value=\"Refuser la commande\" />\r\n                                                <ButtonSmall onClick={() => handleActionSale(sale.id, \"validated\")} color=\"green\" value=\"Accepter la commande\" />\r\n                                            </div>\r\n                                        }\r\n\r\n                                        <CSSTransition\r\n                                            in={sale.status === \"validated\"}\r\n                                            timeout={200}\r\n                                            classNames=\"fromLeftTransition\"\r\n                                            unmountOnExit\r\n                                        >\r\n                                            <ButtonSmall onClick={() => handleActionSale(sale.id, \"rejected\")} color=\"red\" value=\"Annuler la commmande\" />\r\n                                        </CSSTransition>\r\n\r\n                                    </div>\r\n                                    <CSSTransition\r\n                                        in={isModalOpened}\r\n                                        timeout={200}\r\n                                        classNames=\"pageTransition\"\r\n                                        unmountOnExit\r\n                                    >\r\n                                        <ModalYesNo\r\n                                            callback={(val) => handleModalYesNoReturn(val)}\r\n                                            value=\"L'annulation d'une commande est irréversible.\"\r\n                                        />\r\n                                    </CSSTransition>\r\n                                </div>\r\n                            )}\r\n                    </section>\r\n                </div>\r\n            </CSSTransition>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default Prest_Dashboard_Commandes"]},"metadata":{},"sourceType":"module"}